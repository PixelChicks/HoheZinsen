<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Interest Rate Offers</title>
    <script defer src="/js/theme-persistence.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <link href="/css/index.css" rel="stylesheet">
    <link href="/css/faq.css" rel="stylesheet">
    <link href="/css/footer.css" rel="stylesheet">
    <link href="/css/dark-mode.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind:wght@300;400;500;600;700&display=swap');

        * {
            font-family: 'Hind', sans-serif !important;
        }
            <style>
        .logos-section {
            width: 100%;
            overflow: hidden;
            background: transparent;
            padding: 40px 0;
            position: relative;
        }

        .logos-track {
            display: flex;
            padding-top: 40px;
            align-items: center;
            animation: scroll 30s linear(1.15 90.59%, 1.32 108.24%) infinite;
            width: fit-content;
        }

        .logo-item {
            flex-shrink: 0;
            margin: 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
        }

        .logo-item img {
            max-height: 80px;
            max-width: 150px;
            object-fit: contain;
            opacity: 0.7;
            transition: opacity 0.3s ease;
            filter: brightness(1) invert(0);
        }

        .logo-item img:hover {
            opacity: 1;
        }

        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }

        .logos-track:hover {
            animation-play-state: paused;
        }

        .dark-mode .logo-item img {
            filter: brightness(1) invert(1);
        }

        .light-mode .logo-item img {
            filter: brightness(1) invert(1);
        }


        .table-responsive {
          overflow: hidden;
          padding-top: 0;
        }

        #mainTable {
          margin-top: -3px;
          margin-bottom: -3px;
          border-spacing: 0 3px;
          border-collapse: separate;
          background: #f8f9fa;
        }

        #mainTable tbody td {
          padding: 10px 10px;
          vertical-align: middle;
          border: none;
        }

        #mainTable tbody tr:first-child {
          margin-top: 0;
        }

        .container {
          max-width: 1000px;
          margin-left: auto;
          margin-right: auto;
        }

        .body {
         background-color: #f0f0f0 !important;
        }
    </style>
</head>
<body th:classappend="${#authorization.expression('isAuthenticated()')} ? 'authenticated' : 'guest'">

<nav class="top-navigation">
    <div class="container">
        <div class="nav-content">
            <div class="nav-logo">
                <svg fill="none" height="37" viewBox="0 0 173 37" width="173" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 5C21.6569 5 23 6.34315 23 8V24H19V9.5C19 8.67157 18.3284 8 17.5 8C16.6716 8 16 8.67157 16 9.5V24H13V15.5C13 14.6716 12.3284 14 11.5 14C10.6716 14 10 14.6716 10 15.5V24H7V20.5C7 19.6716 6.32843 19 5.5 19C4.67157 19 4 19.6716 4 20.5V24H0V8C0 6.34315 1.34315 5 3 5H20Z"
                          fill="black"/>
                    <path d="M40.017 8.498H42.386V24H40.017V17.215H33.048V24H30.679V8.498H33.048V15.168H40.017V8.498ZM50.5568 24.207C48.8394 24.207 47.4901 23.6473 46.5088 22.528C45.5274 21.4087 45.0368 19.9903 45.0368 18.273C45.0368 16.525 45.5428 15.076 46.5548 13.926C47.5668 12.7607 48.9008 12.178 50.5568 12.178C52.3354 12.178 53.7078 12.7453 54.6738 13.88C55.6398 14.9993 56.1228 16.433 56.1228 18.181C56.1228 19.929 55.6244 21.3703 54.6278 22.505C53.6464 23.6397 52.2894 24.207 50.5568 24.207ZM50.5338 14.087C49.5371 14.087 48.7628 14.4857 48.2108 15.283C47.6588 16.065 47.3828 17.0387 47.3828 18.204C47.3828 19.354 47.6664 20.3277 48.2338 21.125C48.8011 21.907 49.5754 22.298 50.5568 22.298C51.5994 22.298 52.3891 21.9147 52.9258 21.148C53.4778 20.3813 53.7538 19.4077 53.7538 18.227C53.7538 17.0157 53.4931 16.0267 52.9718 15.26C52.4504 14.478 51.6378 14.087 50.5338 14.087ZM60.9172 7.739V14.34C61.5765 12.8987 62.7802 12.178 64.5282 12.178C65.6628 12.178 66.5752 12.5307 67.2652 13.236C67.9552 13.9413 68.3002 14.9227 68.3002 16.18V24H66.0462V16.64C66.0462 15.8427 65.8392 15.2293 65.4252 14.8C65.0265 14.3553 64.4975 14.133 63.8382 14.133C63.0715 14.133 62.3892 14.4243 61.7912 15.007C61.2085 15.5897 60.9172 16.479 60.9172 17.675V24H58.6632V7.739H60.9172ZM78.5761 17.33V16.916C78.5455 16.042 78.3078 15.352 77.8631 14.846C77.4185 14.3247 76.7821 14.064 75.9541 14.064C75.1875 14.064 74.5281 14.3477 73.9761 14.915C73.4241 15.467 73.0791 16.272 72.9411 17.33H78.5761ZM80.0251 21.355V23.379C79.1665 23.8697 78.0318 24.115 76.6211 24.115C74.8118 24.115 73.3705 23.5707 72.2971 22.482C71.2238 21.3933 70.6871 19.9673 70.6871 18.204C70.6871 16.3333 71.1778 14.869 72.1591 13.811C73.1405 12.7377 74.3901 12.201 75.9081 12.201C77.3955 12.201 78.5761 12.6687 79.4501 13.604C80.3241 14.524 80.7611 15.858 80.7611 17.606C80.7611 18.0813 80.7151 18.5797 80.6231 19.101H72.9641C73.1175 20.113 73.5468 20.8873 74.2521 21.424C74.9575 21.9607 75.8468 22.229 76.9201 22.229C78.1621 22.229 79.1971 21.9377 80.0251 21.355ZM93.6961 8.498V10.315L85.8531 22.045H94.0181V24H83.0701V22.137L90.8901 10.453H83.1851V8.498H93.6961ZM96.9388 24V12.339H99.2158V24H96.9388ZM97.0538 9.786C96.7931 9.51 96.6628 9.17267 96.6628 8.774C96.6628 8.37533 96.7931 8.038 97.0538 7.762C97.3298 7.486 97.6671 7.348 98.0658 7.348C98.4644 7.348 98.8018 7.486 99.0778 7.762C99.3538 8.038 99.4918 8.37533 99.4918 8.774C99.4918 9.15733 99.3538 9.487 99.0778 9.763C98.8018 10.039 98.4644 10.177 98.0658 10.177C97.6671 10.177 97.3298 10.0467 97.0538 9.786ZM104.738 12.339V14.34C105.428 12.8987 106.64 12.178 108.372 12.178C109.522 12.178 110.435 12.5307 111.109 13.236C111.784 13.9413 112.121 14.8997 112.121 16.111V24H109.867V16.64C109.867 15.8273 109.66 15.2063 109.246 14.777C108.848 14.3477 108.311 14.133 107.636 14.133C106.839 14.133 106.157 14.4473 105.589 15.076C105.022 15.6893 104.738 16.5557 104.738 17.675V24H102.484V12.339H104.738ZM121.799 12.73V14.777C121.048 14.3323 120.082 14.11 118.901 14.11C118.365 14.11 117.935 14.2327 117.613 14.478C117.307 14.7233 117.153 15.0453 117.153 15.444C117.153 15.5513 117.161 15.6587 117.176 15.766C117.207 15.858 117.253 15.9577 117.314 16.065C117.376 16.157 117.429 16.2413 117.475 16.318C117.537 16.3793 117.629 16.4483 117.751 16.525C117.874 16.6017 117.966 16.6707 118.027 16.732C118.104 16.778 118.219 16.8393 118.372 16.916C118.541 16.9927 118.664 17.054 118.74 17.1C118.817 17.1307 118.947 17.192 119.131 17.284C119.331 17.3607 119.469 17.4143 119.545 17.445C120.45 17.8437 121.155 18.296 121.661 18.802C122.183 19.2927 122.443 19.952 122.443 20.78C122.443 21.8227 122.075 22.643 121.339 23.241C120.603 23.8237 119.607 24.115 118.349 24.115C116.969 24.115 115.819 23.885 114.899 23.425V21.286C115.973 21.9453 117.084 22.275 118.234 22.275C118.832 22.275 119.292 22.1523 119.614 21.907C119.952 21.6617 120.12 21.3397 120.12 20.941C120.12 20.6037 119.99 20.3047 119.729 20.044C119.469 19.768 119.2 19.5687 118.924 19.446C118.664 19.308 118.211 19.101 117.567 18.825C115.743 18.0737 114.83 16.9697 114.83 15.513C114.83 14.4857 115.214 13.6807 115.98 13.098C116.747 12.5153 117.705 12.224 118.855 12.224C120.113 12.224 121.094 12.3927 121.799 12.73ZM132.033 17.33V16.916C132.003 16.042 131.765 15.352 131.32 14.846C130.876 14.3247 130.239 14.064 129.411 14.064C128.645 14.064 127.985 14.3477 127.433 14.915C126.881 15.467 126.536 16.272 126.398 17.33H132.033ZM133.482 21.355V23.379C132.624 23.8697 131.489 24.115 130.078 24.115C128.269 24.115 126.828 23.5707 125.754 22.482C124.681 21.3933 124.144 19.9673 124.144 18.204C124.144 16.3333 124.635 14.869 125.616 13.811C126.598 12.7377 127.847 12.201 129.365 12.201C130.853 12.201 132.033 12.6687 132.907 13.604C133.781 14.524 134.218 15.858 134.218 17.606C134.218 18.0813 134.172 18.5797 134.08 19.101H126.421C126.575 20.113 127.004 20.8873 127.709 21.424C128.415 21.9607 129.304 22.229 130.377 22.229C131.619 22.229 132.654 21.9377 133.482 21.355ZM139.126 12.339V14.34C139.816 12.8987 141.027 12.178 142.76 12.178C143.91 12.178 144.822 12.5307 145.497 13.236C146.172 13.9413 146.509 14.8997 146.509 16.111V24H144.255V16.64C144.255 15.8273 144.048 15.2063 143.634 14.777C143.235 14.3477 142.699 14.133 142.024 14.133C141.227 14.133 140.544 14.4473 139.977 15.076C139.41 15.6893 139.126 16.5557 139.126 17.675V24H136.872V12.339H139.126ZM149.057 23.724C148.766 23.4173 148.62 23.0493 148.62 22.62C148.62 22.1907 148.766 21.8303 149.057 21.539C149.364 21.2323 149.739 21.079 150.184 21.079C150.613 21.079 150.974 21.2323 151.265 21.539C151.572 21.8303 151.725 22.1907 151.725 22.62C151.725 23.0493 151.572 23.4173 151.265 23.724C150.974 24.0307 150.613 24.184 150.184 24.184C149.739 24.184 149.364 24.0307 149.057 23.724ZM160.128 18.802H158.38C157.522 18.802 156.87 18.9707 156.425 19.308C155.996 19.6453 155.781 20.0747 155.781 20.596C155.781 21.1327 155.95 21.5543 156.287 21.861C156.625 22.1677 157.115 22.321 157.759 22.321C158.495 22.321 159.07 22.1217 159.484 21.723C159.914 21.309 160.128 20.7723 160.128 20.113V18.802ZM154.263 15.122V12.937C155.168 12.4157 156.364 12.155 157.851 12.155C160.903 12.155 162.428 13.6347 162.428 16.594V24H160.197V22.62C159.599 23.6013 158.549 24.092 157.046 24.092C155.942 24.092 155.053 23.7777 154.378 23.149C153.719 22.505 153.389 21.6923 153.389 20.711C153.389 19.5917 153.811 18.7253 154.654 18.112C155.498 17.4833 156.678 17.169 158.196 17.169H160.128V16.502C160.128 15.7047 159.937 15.1067 159.553 14.708C159.17 14.294 158.534 14.087 157.644 14.087C156.402 14.087 155.275 14.432 154.263 15.122ZM168.386 14.087V20.504C168.386 21.6233 168.923 22.183 169.996 22.183C170.625 22.183 171.154 22.0143 171.583 21.677V23.701C171.077 23.977 170.456 24.115 169.72 24.115C167.313 24.115 166.109 22.896 166.109 20.458V14.087H164.292V12.339H166.109V9.487H168.386V12.339H171.445V14.087H168.386Z"
                          fill="#030303"/>
                </svg>

                <svg fill="none" height="37" viewBox="0 0 173 37" width="173" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 5C21.6569 5 23 6.34315 23 8V24H19V9.5C19 8.67157 18.3284 8 17.5 8C16.6716 8 16 8.67157 16 9.5V24H13V15.5C13 14.6716 12.3284 14 11.5 14C10.6716 14 10 14.6716 10 15.5V24H7V20.5C7 19.6716 6.32843 19 5.5 19C4.67157 19 4 19.6716 4 20.5V24H0V8C0 6.34315 1.34315 5 3 5H20Z"
                          fill="white"/>
                    <path d="M40.017 8.498H42.386V24H40.017V17.215H33.048V24H30.679V8.498H33.048V15.168H40.017V8.498ZM50.5568 24.207C48.8394 24.207 47.4901 23.6473 46.5088 22.528C45.5274 21.4087 45.0368 19.9903 45.0368 18.273C45.0368 16.525 45.5428 15.076 46.5548 13.926C47.5668 12.7607 48.9008 12.178 50.5568 12.178C52.3354 12.178 53.7078 12.7453 54.6738 13.88C55.6398 14.9993 56.1228 16.433 56.1228 18.181C56.1228 19.929 55.6244 21.3703 54.6278 22.505C53.6464 23.6397 52.2894 24.207 50.5568 24.207ZM50.5338 14.087C49.5371 14.087 48.7628 14.4857 48.2108 15.283C47.6588 16.065 47.3828 17.0387 47.3828 18.204C47.3828 19.354 47.6664 20.3277 48.2338 21.125C48.8011 21.907 49.5754 22.298 50.5568 22.298C51.5994 22.298 52.3891 21.9147 52.9258 21.148C53.4778 20.3813 53.7538 19.4077 53.7538 18.227C53.7538 17.0157 53.4931 16.0267 52.9718 15.26C52.4504 14.478 51.6378 14.087 50.5338 14.087ZM60.9172 7.739V14.34C61.5765 12.8987 62.7802 12.178 64.5282 12.178C65.6628 12.178 66.5752 12.5307 67.2652 13.236C67.9552 13.9413 68.3002 14.9227 68.3002 16.18V24H66.0462V16.64C66.0462 15.8427 65.8392 15.2293 65.4252 14.8C65.0265 14.3553 64.4975 14.133 63.8382 14.133C63.0715 14.133 62.3892 14.4243 61.7912 15.007C61.2085 15.5897 60.9172 16.479 60.9172 17.675V24H58.6632V7.739H60.9172ZM78.5761 17.33V16.916C78.5455 16.042 78.3078 15.352 77.8631 14.846C77.4185 14.3247 76.7821 14.064 75.9541 14.064C75.1875 14.064 74.5281 14.3477 73.9761 14.915C73.4241 15.467 73.0791 16.272 72.9411 17.33H78.5761ZM80.0251 21.355V23.379C79.1665 23.8697 78.0318 24.115 76.6211 24.115C74.8118 24.115 73.3705 23.5707 72.2971 22.482C71.2238 21.3933 70.6871 19.9673 70.6871 18.204C70.6871 16.3333 71.1778 14.869 72.1591 13.811C73.1405 12.7377 74.3901 12.201 75.9081 12.201C77.3955 12.201 78.5761 12.6687 79.4501 13.604C80.3241 14.524 80.7611 15.858 80.7611 17.606C80.7611 18.0813 80.7151 18.5797 80.6231 19.101H72.9641C73.1175 20.113 73.5468 20.8873 74.2521 21.424C74.9575 21.9607 75.8468 22.229 76.9201 22.229C78.1621 22.229 79.1971 21.9377 80.0251 21.355ZM93.6961 8.498V10.315L85.8531 22.045H94.0181V24H83.0701V22.137L90.8901 10.453H83.1851V8.498H93.6961ZM96.9388 24V12.339H99.2158V24H96.9388ZM97.0538 9.786C96.7931 9.51 96.6628 9.17267 96.6628 8.774C96.6628 8.37533 96.7931 8.038 97.0538 7.762C97.3298 7.486 97.6671 7.348 98.0658 7.348C98.4644 7.348 98.8018 7.486 99.0778 7.762C99.3538 8.038 99.4918 8.37533 99.4918 8.774C99.4918 9.15733 99.3538 9.487 99.0778 9.763C98.8018 10.039 98.4644 10.177 98.0658 10.177C97.6671 10.177 97.3298 10.0467 97.0538 9.786ZM104.738 12.339V14.34C105.428 12.8987 106.64 12.178 108.372 12.178C109.522 12.178 110.435 12.5307 111.109 13.236C111.784 13.9413 112.121 14.8997 112.121 16.111V24H109.867V16.64C109.867 15.8273 109.66 15.2063 109.246 14.777C108.848 14.3477 108.311 14.133 107.636 14.133C106.839 14.133 106.157 14.4473 105.589 15.076C105.022 15.6893 104.738 16.5557 104.738 17.675V24H102.484V12.339H104.738ZM121.799 12.73V14.777C121.048 14.3323 120.082 14.11 118.901 14.11C118.365 14.11 117.935 14.2327 117.613 14.478C117.307 14.7233 117.153 15.0453 117.153 15.444C117.153 15.5513 117.161 15.6587 117.176 15.766C117.207 15.858 117.253 15.9577 117.314 16.065C117.376 16.157 117.429 16.2413 117.475 16.318C117.537 16.3793 117.629 16.4483 117.751 16.525C117.874 16.6017 117.966 16.6707 118.027 16.732C118.104 16.778 118.219 16.8393 118.372 16.916C118.541 16.9927 118.664 17.054 118.74 17.1C118.817 17.1307 118.947 17.192 119.131 17.284C119.331 17.3607 119.469 17.4143 119.545 17.445C120.45 17.8437 121.155 18.296 121.661 18.802C122.183 19.2927 122.443 19.952 122.443 20.78C122.443 21.8227 122.075 22.643 121.339 23.241C120.603 23.8237 119.607 24.115 118.349 24.115C116.969 24.115 115.819 23.885 114.899 23.425V21.286C115.973 21.9453 117.084 22.275 118.234 22.275C118.832 22.275 119.292 22.1523 119.614 21.907C119.952 21.6617 120.12 21.3397 120.12 20.941C120.12 20.6037 119.99 20.3047 119.729 20.044C119.469 19.768 119.2 19.5687 118.924 19.446C118.664 19.308 118.211 19.101 117.567 18.825C115.743 18.0737 114.83 16.9697 114.83 15.513C114.83 14.4857 115.214 13.6807 115.98 13.098C116.747 12.5153 117.705 12.224 118.855 12.224C120.113 12.224 121.094 12.3927 121.799 12.73ZM132.033 17.33V16.916C132.003 16.042 131.765 15.352 131.32 14.846C130.876 14.3247 130.239 14.064 129.411 14.064C128.645 14.064 127.985 14.3477 127.433 14.915C126.881 15.467 126.536 16.272 126.398 17.33H132.033ZM133.482 21.355V23.379C132.624 23.8697 131.489 24.115 130.078 24.115C128.269 24.115 126.828 23.5707 125.754 22.482C124.681 21.3933 124.144 19.9673 124.144 18.204C124.144 16.3333 124.635 14.869 125.616 13.811C126.598 12.7377 127.847 12.201 129.365 12.201C130.853 12.201 132.033 12.6687 132.907 13.604C133.781 14.524 134.218 15.858 134.218 17.606C134.218 18.0813 134.172 18.5797 134.08 19.101H126.421C126.575 20.113 127.004 20.8873 127.709 21.424C128.415 21.9607 129.304 22.229 130.377 22.229C131.619 22.229 132.654 21.9377 133.482 21.355ZM139.126 12.339V14.34C139.816 12.8987 141.027 12.178 142.76 12.178C143.91 12.178 144.822 12.5307 145.497 13.236C146.172 13.9413 146.509 14.8997 146.509 16.111V24H144.255V16.64C144.255 15.8273 144.048 15.2063 143.634 14.777C143.235 14.3477 142.699 14.133 142.024 14.133C141.227 14.133 140.544 14.4473 139.977 15.076C139.41 15.6893 139.126 16.5557 139.126 17.675V24H136.872V12.339H139.126ZM149.057 23.724C148.766 23.4173 148.62 23.0493 148.62 22.62C148.62 22.1907 148.766 21.8303 149.057 21.539C149.364 21.2323 149.739 21.079 150.184 21.079C150.613 21.079 150.974 21.2323 151.265 21.539C151.572 21.8303 151.725 22.1907 151.725 22.62C151.725 23.0493 151.572 23.4173 151.265 23.724C150.974 24.0307 150.613 24.184 150.184 24.184C149.739 24.184 149.364 24.0307 149.057 23.724ZM160.128 18.802H158.38C157.522 18.802 156.87 18.9707 156.425 19.308C155.996 19.6453 155.781 20.0747 155.781 20.596C155.781 21.1327 155.95 21.5543 156.287 21.861C156.625 22.1677 157.115 22.321 157.759 22.321C158.495 22.321 159.07 22.1217 159.484 21.723C159.914 21.309 160.128 20.7723 160.128 20.113V18.802ZM154.263 15.122V12.937C155.168 12.4157 156.364 12.155 157.851 12.155C160.903 12.155 162.428 13.6347 162.428 16.594V24H160.197V22.62C159.599 23.6013 158.549 24.092 157.046 24.092C155.942 24.092 155.053 23.7777 154.378 23.149C153.719 22.505 153.389 21.6923 153.389 20.711C153.389 19.5917 153.811 18.7253 154.654 18.112C155.498 17.4833 156.678 17.169 158.196 17.169H160.128V16.502C160.128 15.7047 159.937 15.1067 159.553 14.708C159.17 14.294 158.534 14.087 157.644 14.087C156.402 14.087 155.275 14.432 154.263 15.122ZM168.386 14.087V20.504C168.386 21.6233 168.923 22.183 169.996 22.183C170.625 22.183 171.154 22.0143 171.583 21.677V23.701C171.077 23.977 170.456 24.115 169.72 24.115C167.313 24.115 166.109 22.896 166.109 20.458V14.087H164.292V12.339H166.109V9.487H168.386V12.339H171.445V14.087H168.386Z"
                          fill="white"/>
                </svg>

            </div>
            <div class="nav-links">
                <a class="nav-link" href="#compare-section" onclick="handleCompareNav(event)">Compare</a>
                <a class="nav-link" href="#faq-section">FAQs</a>
                <div class="theme-segmented-switch" id="darkModeToggleContainer">

                    <button aria-label="Activate light mode"
                            class="switch-segment active-segment"
                            id="lightModeBtn"
                            onclick="window.darkModeControls.disable()">
                        <svg height="100" viewBox="0 0 30 30" width="100" x="0px" xmlns="http://www.w3.org/2000/svg"
                             y="0px">
                            <path d="M 14.984375 0.98632812 A 1.0001 1.0001 0 0 0 14 2 L 14 5 A 1.0001 1.0001 0 1 0 16 5 L 16 2 A 1.0001 1.0001 0 0 0 14.984375 0.98632812 z M 5.796875 4.7988281 A 1.0001 1.0001 0 0 0 5.1015625 6.515625 L 7.2226562 8.6367188 A 1.0001 1.0001 0 1 0 8.6367188 7.2226562 L 6.515625 5.1015625 A 1.0001 1.0001 0 0 0 5.796875 4.7988281 z M 24.171875 4.7988281 A 1.0001 1.0001 0 0 0 23.484375 5.1015625 L 21.363281 7.2226562 A 1.0001 1.0001 0 1 0 22.777344 8.6367188 L 24.898438 6.515625 A 1.0001 1.0001 0 0 0 24.171875 4.7988281 z M 15 8 A 7 7 0 0 0 8 15 A 7 7 0 0 0 15 22 A 7 7 0 0 0 22 15 A 7 7 0 0 0 15 8 z M 2 14 A 1.0001 1.0001 0 1 0 2 16 L 5 16 A 1.0001 1.0001 0 1 0 5 14 L 2 14 z M 25 14 A 1.0001 1.0001 0 1 0 25 16 L 28 16 A 1.0001 1.0001 0 1 0 28 14 L 25 14 z M 7.9101562 21.060547 A 1.0001 1.0001 0 0 0 7.2226562 21.363281 L 5.1015625 23.484375 A 1.0001 1.0001 0 1 0 6.515625 24.898438 L 8.6367188 22.777344 A 1.0001 1.0001 0 0 0 7.9101562 21.060547 z M 22.060547 21.060547 A 1.0001 1.0001 0 0 0 21.363281 22.777344 L 23.484375 24.898438 A 1.0001 1.0001 0 1 0 24.898438 23.484375 L 22.777344 21.363281 A 1.0001 1.0001 0 0 0 22.060547 21.060547 z M 14.984375 23.986328 A 1.0001 1.0001 0 0 0 14 25 L 14 28 A 1.0001 1.0001 0 1 0 16 28 L 16 25 A 1.0001 1.0001 0 0 0 14.984375 23.986328 z"></path>
                        </svg>
                    </button>

                    <button aria-label="Activate dark mode"
                            class="switch-segment"
                            id="darkModeBtn"
                            onclick="window.darkModeControls.enable()">
                        <svg fill="none" height="48" viewBox="0 0 48 48" width="48" xmlns="http://www.w3.org/2000/svg">
                            <path d="M42 25.58C41.6854 28.9844 40.4078 32.2288 38.3165 34.9336C36.2253 37.6383 33.407 39.6916 30.1915 40.8531C26.9759 42.0146 23.496 42.2362 20.159 41.4922C16.8221 40.7481 13.766 39.0691 11.3485 36.6516C8.93096 34.234 7.25193 31.178 6.50786 27.841C5.7638 24.504 5.98548 21.0242 7.14697 17.8086C8.30845 14.593 10.3617 11.7747 13.0665 9.68351C15.7712 7.59228 19.0156 6.31461 22.42 6C20.4269 8.69653 19.4677 12.0189 19.7171 15.3628C19.9665 18.7068 21.4078 21.8501 23.7789 24.2212C26.1499 26.5923 29.2933 28.0336 32.6372 28.2829C35.9811 28.5323 39.3035 27.5732 42 25.58Z"
                                  stroke="#999999" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- Hero Section -->
<div class="hero-section" style="padding-top: 40px; padding-bottom: 20px;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-7 col-md-6" style="padding-left: 40px;">
                <div class="hero-content">
                    <h1>Top-Zinsen sichern:<br>Jetzt mehr aus Ihrem Geld machen</h1>
                </div>
                <div class="hero-content" style="max-width: 400px;">
                    <p>Die aktuell h√∂chsten Zinsangebote f√ºr Ihr Erspartes ‚Äì transparent und objektiv.</p>
                </div>
            </div>
            <div class="col-lg-5 col-md-6 d-flex justify-content-center">
                <img alt="Illustration showing financial growth and percentages" class="hero-illustration-image"
                     src="https://i.ibb.co/6cYSQPBW/hero-illustration.png" style="max-width: 70%; height: auto;
                     padding-right: 20px; padding-bottom: 10px;">
            </div>
        </div>
    </div>
    <div class="logos-section" style="overflow-x: hidden;">
        <div class="logos-track">
            <!-- First set of logos -->
            <div class="logo-item">
                <img alt="Armeec" src="static/images/Armeec.png">
            </div>
            <div class="logo-item">
                <img alt="Bulins" src="static/images/Bulins.png">
            </div>
            <div class="logo-item">
                <img alt="Bulstrad" src="static/images/Bulstrad.png">
            </div>
            <div class="logo-item">
                <img alt="DZI" src="static/images/DZI.png">
            </div>
            <div class="logo-item">
                <img alt="Euroins" src="static/images/Euroins.png">
            </div>
            <div class="logo-item">
                <img alt="Generali" src="static/images/Generali.png">
            </div>
            <div class="logo-item">
                <img alt="Uniqa" src="static/images/Uniqa.png">
            </div>

            <!-- Duplicate set for seamless loop -->
            <div class="logo-item">
                <img alt="Armeec" src="static/images/Armeec.png">
            </div>
            <div class="logo-item">
                <img alt="Bulins" src="static/images/Bulins.png">
            </div>
            <div class="logo-item">
                <img alt="Bulstrad" src="static/images/Bulstrad.png">
            </div>
            <div class="logo-item">
                <img alt="DZI" src="static/images/DZI.png">
            </div>
            <div class="logo-item">
                <img alt="Euroins" src="static/images/Euroins.png">
            </div>
            <div class="logo-item">
                <img alt="Generali" src="static/images/Generali.png">
            </div>
            <div class="logo-item">
                <img alt="Uniqa" src="static/images/Uniqa.png">
            </div>

            <!-- Duplicate set for seamless loop -->
            <div class="logo-item">
                <img alt="Armeec" src="static/images/Armeec.png">
            </div>
            <div class="logo-item">
                <img alt="Bulins" src="static/images/Bulins.png">
            </div>
            <div class="logo-item">
                <img alt="Bulstrad" src="static/images/Bulstrad.png">
            </div>
            <div class="logo-item">
                <img alt="DZI" src="static/images/DZI.png">
            </div>
            <div class="logo-item">
                <img alt="Euroins" src="static/images/Euroins.png">
            </div>
            <div class="logo-item">
                <img alt="Generali" src="static/images/Generali.png">
            </div>
            <div class="logo-item">
                <img alt="Uniqa" src="static/images/Uniqa.png">
            </div>
            <div class="logo-item">
                <img alt="Armeec" src="static/images/Armeec.png">
            </div>
            <div class="logo-item">
                <img alt="Bulins" src="static/images/Bulins.png">
            </div>
            <div class="logo-item">
                <img alt="Bulstrad" src="static/images/Bulstrad.png">
            </div>
            <div class="logo-item">
                <img alt="DZI" src="static/images/DZI.png">
            </div>
            <div class="logo-item">
                <img alt="Euroins" src="static/images/Euroins.png">
            </div>
            <div class="logo-item">
                <img alt="Generali" src="static/images/Generali.png">
            </div>
            <div class="logo-item">
                <img alt="Uniqa" src="static/images/Uniqa.png">
            </div>
        </div>
    </div>
</div>
<div class="vergleichen-section" id="compare-section" style="scroll-margin-top: 100px;">
    <div class="card-body py-2">
        <small>
            <button class="vergleichen-header" id="quickCompareBtn" onclick="quickStartComparison()">
                Vergleichen
            </button>
        </small>
        <span style="padding-top: 20px;color: rgb(100 107 119);" th:text="${lastUpdateMessage}">Last updated 20 hours ago</span>
    </div>
</div>
<div class="vergleichen-section" style="border-bottom: 1px solid rgb(206 206 206);">
    <div class="card-body py-2">
        <div class="comparison-section" id="comparisonSection" style="display: none;">
            <div class="comparison-header">
            </div>

            <div class="comparison-limit-warning" id="comparisonWarning">
                Sie k√∂nnen maximal 3 Zinss√§tze gleichzeitig vergleichen. Entfernen Sie einen Vergleich, um einen neuen
                hinzuzuf√ºgen.
            </div>

            <div class="comparison-container" id="comparisonContainer">
                <!-- Comparison layout will be populated here -->
            </div>

            <div class="empty-comparison-state" id="emptyComparisonState">
                <p>click a provider from the table below to add to compare</p>
            </div>
        </div>
    </div>
</div>
<div class="container py-4">
    <!-- View Toggle for Mobile -->
    <div class="view-toggle d-md-none">
        <div aria-label="View toggle" class="btn-group" role="group">
            <button class="btn btn-outline-primary active" id="stackedView" type="button">
                üì± Card View
            </button>
            <button class="btn btn-outline-primary" id="scrollView" type="button">
                üìä Table View
            </button>
        </div>
    </div>

    <div class="filter-section" id="filterSection">
        <div class="filter-content" id="filterContent">
            <div class="active-filters" id="activeFilters">
            </div>
            <div class="filter-grid" id="filterGrid">
            </div>
        </div>
    </div>

    <div class="table-with-checkboxes-container">
        <!-- Checkbox column - positioned absolutely to left of table -->
        <div class="external-checkboxes-column" id="externalCheckboxes">
            <!-- Checkboxes will be populated here by JavaScript -->
        </div>
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
        </div>

        <div class="scroll-indicator" id="scrollIndicator">‚Üê Scroll horizontally to see more ‚Üí</div>

        <div class="table-responsive" id="tableContainer">
            <table class="table table-sm" id="mainTable">
                <thead class="table">
                <tr id="column-header-row">
                    <th onclick="sortTable(this, event)"
                        th:attr="ondragend=${#authorization.expression('isAuthenticated()')} ? 'handleDragEnd(event)' : null,
                                 ondragover=${#authorization.expression('isAuthenticated()')} ? 'handleDragOver(event)' : null,
                                 ondragstart=${#authorization.expression('isAuthenticated()')} ? 'handleDragStart(event)' : null,
                                 ondrop=${#authorization.expression('isAuthenticated()')} ? 'handleDrop(event)' : null"
                        th:class="${#authorization.expression('isAuthenticated()')} ? 'draggable-column sortable' : 'sortable'"
                        th:data-column-index="${iterStat.index}"
                        th:data-field-id="${field.id}"
                        th:data-field-key="${field.fieldKey}"
                        th:draggable="${#authorization.expression('isAuthenticated()')}"
                        th:each="field, iterStat : ${globalFields}">

                        <div class="header-container">
                            <span class="header-text" th:text="${field.label}"></span>
                        </div>
                    </th>
                    <th class="no-drag"></th>
                </tr>
                </thead>

                <tbody id="tableBody">
                <!-- Data rows will be populated by JavaScript -->
                </tbody>
            </table>

            <!-- Empty state -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div>üìä</div>
                <h5>No interest rates found</h5>
                <p>Try adjusting your search criteria or add a new interest rate.</p>
            </div>
        </div>
    </div>

    <div class="load-more-container mt-4 mb-4 text-center">
        <div class="loading-more-indicator" id="loadingMoreIndicator" style="display: none;">
            <div class="text-center py-4">
                <div class="spinner-border spinner-border-sm me-2" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <span class="text-muted">Loading more rates...</span>
            </div>
        </div>

        <button class="nav-logo" id="loadMoreBtn" style="background: rgba(75, 84, 99, 1); color: #fff;" onclick="loadMoreData()">
            Load More
        </button>

        <div class="results-info-footer mt-2" id="resultsInfoFooter">
        </div>
    </div>
</div>
<div class="mission-section" id="faq-section" style="scroll-margin-top: 100px;">
    <div class="faq-container">
        <h1 class="faq-title" style="padding-top: 60px; padding-bottom: 30px;">FAQs</h1>

        <div th:if="${faqs == null || faqs.isEmpty()}" class="text-center py-5">
            <p class="text-muted">No FAQs available at the moment.</p>
        </div>

        <div th:each="faq : ${faqs}" class="faq-item">
            <div class="faq-question" onclick="toggleFaq(this)">
                <div class="faq-icon">+</div>
                <div class="faq-question-text" th:text="${faq.question}"></div>
            </div>
            <div class="faq-answer">
                <div class="faq-answer-text" th:utext="${faq.answer}"></div>
            </div>
        </div>
    </div>
</div>
<div class="mission-section" id="about-section" style="scroll-margin-top: 100px;">
    <div class="faq-container">
        <h1 class="faq-title"
            style="padding-top: 60px; padding-bottom: 30px;"
            th:text="${aboutSection != null ? aboutSection.title : 'No title'}">
        </h1>

        <div class="faq-answer-text"
             th:utext="${aboutSection != null ? aboutSection.content : 'No about us section for now...'}"><br>
            <b></b><br><br>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="footer-container">
        <!-- Brand Section -->
        <div class="footer-brand">
            <div class="nav-logo">
                <svg fill="none" height="37" viewBox="0 0 173 37" width="173" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 5C21.6569 5 23 6.34315 23 8V24H19V9.5C19 8.67157 18.3284 8 17.5 8C16.6716 8 16 8.67157 16 9.5V24H13V15.5C13 14.6716 12.3284 14 11.5 14C10.6716 14 10 14.6716 10 15.5V24H7V20.5C7 19.6716 6.32843 19 5.5 19C4.67157 19 4 19.6716 4 20.5V24H0V8C0 6.34315 1.34315 5 3 5H20Z"
                          fill="black"/>
                    <path d="M40.017 8.498H42.386V24H40.017V17.215H33.048V24H30.679V8.498H33.048V15.168H40.017V8.498ZM50.5568 24.207C48.8394 24.207 47.4901 23.6473 46.5088 22.528C45.5274 21.4087 45.0368 19.9903 45.0368 18.273C45.0368 16.525 45.5428 15.076 46.5548 13.926C47.5668 12.7607 48.9008 12.178 50.5568 12.178C52.3354 12.178 53.7078 12.7453 54.6738 13.88C55.6398 14.9993 56.1228 16.433 56.1228 18.181C56.1228 19.929 55.6244 21.3703 54.6278 22.505C53.6464 23.6397 52.2894 24.207 50.5568 24.207ZM50.5338 14.087C49.5371 14.087 48.7628 14.4857 48.2108 15.283C47.6588 16.065 47.3828 17.0387 47.3828 18.204C47.3828 19.354 47.6664 20.3277 48.2338 21.125C48.8011 21.907 49.5754 22.298 50.5568 22.298C51.5994 22.298 52.3891 21.9147 52.9258 21.148C53.4778 20.3813 53.7538 19.4077 53.7538 18.227C53.7538 17.0157 53.4931 16.0267 52.9718 15.26C52.4504 14.478 51.6378 14.087 50.5338 14.087ZM60.9172 7.739V14.34C61.5765 12.8987 62.7802 12.178 64.5282 12.178C65.6628 12.178 66.5752 12.5307 67.2652 13.236C67.9552 13.9413 68.3002 14.9227 68.3002 16.18V24H66.0462V16.64C66.0462 15.8427 65.8392 15.2293 65.4252 14.8C65.0265 14.3553 64.4975 14.133 63.8382 14.133C63.0715 14.133 62.3892 14.4243 61.7912 15.007C61.2085 15.5897 60.9172 16.479 60.9172 17.675V24H58.6632V7.739H60.9172ZM78.5761 17.33V16.916C78.5455 16.042 78.3078 15.352 77.8631 14.846C77.4185 14.3247 76.7821 14.064 75.9541 14.064C75.1875 14.064 74.5281 14.3477 73.9761 14.915C73.4241 15.467 73.0791 16.272 72.9411 17.33H78.5761ZM80.0251 21.355V23.379C79.1665 23.8697 78.0318 24.115 76.6211 24.115C74.8118 24.115 73.3705 23.5707 72.2971 22.482C71.2238 21.3933 70.6871 19.9673 70.6871 18.204C70.6871 16.3333 71.1778 14.869 72.1591 13.811C73.1405 12.7377 74.3901 12.201 75.9081 12.201C77.3955 12.201 78.5761 12.6687 79.4501 13.604C80.3241 14.524 80.7611 15.858 80.7611 17.606C80.7611 18.0813 80.7151 18.5797 80.6231 19.101H72.9641C73.1175 20.113 73.5468 20.8873 74.2521 21.424C74.9575 21.9607 75.8468 22.229 76.9201 22.229C78.1621 22.229 79.1971 21.9377 80.0251 21.355ZM93.6961 8.498V10.315L85.8531 22.045H94.0181V24H83.0701V22.137L90.8901 10.453H83.1851V8.498H93.6961ZM96.9388 24V12.339H99.2158V24H96.9388ZM97.0538 9.786C96.7931 9.51 96.6628 9.17267 96.6628 8.774C96.6628 8.37533 96.7931 8.038 97.0538 7.762C97.3298 7.486 97.6671 7.348 98.0658 7.348C98.4644 7.348 98.8018 7.486 99.0778 7.762C99.3538 8.038 99.4918 8.37533 99.4918 8.774C99.4918 9.15733 99.3538 9.487 99.0778 9.763C98.8018 10.039 98.4644 10.177 98.0658 10.177C97.6671 10.177 97.3298 10.0467 97.0538 9.786ZM104.738 12.339V14.34C105.428 12.8987 106.64 12.178 108.372 12.178C109.522 12.178 110.435 12.5307 111.109 13.236C111.784 13.9413 112.121 14.8997 112.121 16.111V24H109.867V16.64C109.867 15.8273 109.66 15.2063 109.246 14.777C108.848 14.3477 108.311 14.133 107.636 14.133C106.839 14.133 106.157 14.4473 105.589 15.076C105.022 15.6893 104.738 16.5557 104.738 17.675V24H102.484V12.339H104.738ZM121.799 12.73V14.777C121.048 14.3323 120.082 14.11 118.901 14.11C118.365 14.11 117.935 14.2327 117.613 14.478C117.307 14.7233 117.153 15.0453 117.153 15.444C117.153 15.5513 117.161 15.6587 117.176 15.766C117.207 15.858 117.253 15.9577 117.314 16.065C117.376 16.157 117.429 16.2413 117.475 16.318C117.537 16.3793 117.629 16.4483 117.751 16.525C117.874 16.6017 117.966 16.6707 118.027 16.732C118.104 16.778 118.219 16.8393 118.372 16.916C118.541 16.9927 118.664 17.054 118.74 17.1C118.817 17.1307 118.947 17.192 119.131 17.284C119.331 17.3607 119.469 17.4143 119.545 17.445C120.45 17.8437 121.155 18.296 121.661 18.802C122.183 19.2927 122.443 19.952 122.443 20.78C122.443 21.8227 122.075 22.643 121.339 23.241C120.603 23.8237 119.607 24.115 118.349 24.115C116.969 24.115 115.819 23.885 114.899 23.425V21.286C115.973 21.9453 117.084 22.275 118.234 22.275C118.832 22.275 119.292 22.1523 119.614 21.907C119.952 21.6617 120.12 21.3397 120.12 20.941C120.12 20.6037 119.99 20.3047 119.729 20.044C119.469 19.768 119.2 19.5687 118.924 19.446C118.664 19.308 118.211 19.101 117.567 18.825C115.743 18.0737 114.83 16.9697 114.83 15.513C114.83 14.4857 115.214 13.6807 115.98 13.098C116.747 12.5153 117.705 12.224 118.855 12.224C120.113 12.224 121.094 12.3927 121.799 12.73ZM132.033 17.33V16.916C132.003 16.042 131.765 15.352 131.32 14.846C130.876 14.3247 130.239 14.064 129.411 14.064C128.645 14.064 127.985 14.3477 127.433 14.915C126.881 15.467 126.536 16.272 126.398 17.33H132.033ZM133.482 21.355V23.379C132.624 23.8697 131.489 24.115 130.078 24.115C128.269 24.115 126.828 23.5707 125.754 22.482C124.681 21.3933 124.144 19.9673 124.144 18.204C124.144 16.3333 124.635 14.869 125.616 13.811C126.598 12.7377 127.847 12.201 129.365 12.201C130.853 12.201 132.033 12.6687 132.907 13.604C133.781 14.524 134.218 15.858 134.218 17.606C134.218 18.0813 134.172 18.5797 134.08 19.101H126.421C126.575 20.113 127.004 20.8873 127.709 21.424C128.415 21.9607 129.304 22.229 130.377 22.229C131.619 22.229 132.654 21.9377 133.482 21.355ZM139.126 12.339V14.34C139.816 12.8987 141.027 12.178 142.76 12.178C143.91 12.178 144.822 12.5307 145.497 13.236C146.172 13.9413 146.509 14.8997 146.509 16.111V24H144.255V16.64C144.255 15.8273 144.048 15.2063 143.634 14.777C143.235 14.3477 142.699 14.133 142.024 14.133C141.227 14.133 140.544 14.4473 139.977 15.076C139.41 15.6893 139.126 16.5557 139.126 17.675V24H136.872V12.339H139.126ZM149.057 23.724C148.766 23.4173 148.62 23.0493 148.62 22.62C148.62 22.1907 148.766 21.8303 149.057 21.539C149.364 21.2323 149.739 21.079 150.184 21.079C150.613 21.079 150.974 21.2323 151.265 21.539C151.572 21.8303 151.725 22.1907 151.725 22.62C151.725 23.0493 151.572 23.4173 151.265 23.724C150.974 24.0307 150.613 24.184 150.184 24.184C149.739 24.184 149.364 24.0307 149.057 23.724ZM160.128 18.802H158.38C157.522 18.802 156.87 18.9707 156.425 19.308C155.996 19.6453 155.781 20.0747 155.781 20.596C155.781 21.1327 155.95 21.5543 156.287 21.861C156.625 22.1677 157.115 22.321 157.759 22.321C158.495 22.321 159.07 22.1217 159.484 21.723C159.914 21.309 160.128 20.7723 160.128 20.113V18.802ZM154.263 15.122V12.937C155.168 12.4157 156.364 12.155 157.851 12.155C160.903 12.155 162.428 13.6347 162.428 16.594V24H160.197V22.62C159.599 23.6013 158.549 24.092 157.046 24.092C155.942 24.092 155.053 23.7777 154.378 23.149C153.719 22.505 153.389 21.6923 153.389 20.711C153.389 19.5917 153.811 18.7253 154.654 18.112C155.498 17.4833 156.678 17.169 158.196 17.169H160.128V16.502C160.128 15.7047 159.937 15.1067 159.553 14.708C159.17 14.294 158.534 14.087 157.644 14.087C156.402 14.087 155.275 14.432 154.263 15.122ZM168.386 14.087V20.504C168.386 21.6233 168.923 22.183 169.996 22.183C170.625 22.183 171.154 22.0143 171.583 21.677V23.701C171.077 23.977 170.456 24.115 169.72 24.115C167.313 24.115 166.109 22.896 166.109 20.458V14.087H164.292V12.339H166.109V9.487H168.386V12.339H171.445V14.087H168.386Z"
                          fill="#030303"/>
                </svg>

                <svg fill="none" height="37" viewBox="0 0 173 37" width="173" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 5C21.6569 5 23 6.34315 23 8V24H19V9.5C19 8.67157 18.3284 8 17.5 8C16.6716 8 16 8.67157 16 9.5V24H13V15.5C13 14.6716 12.3284 14 11.5 14C10.6716 14 10 14.6716 10 15.5V24H7V20.5C7 19.6716 6.32843 19 5.5 19C4.67157 19 4 19.6716 4 20.5V24H0V8C0 6.34315 1.34315 5 3 5H20Z"
                          fill="white"/>
                    <path d="M40.017 8.498H42.386V24H40.017V17.215H33.048V24H30.679V8.498H33.048V15.168H40.017V8.498ZM50.5568 24.207C48.8394 24.207 47.4901 23.6473 46.5088 22.528C45.5274 21.4087 45.0368 19.9903 45.0368 18.273C45.0368 16.525 45.5428 15.076 46.5548 13.926C47.5668 12.7607 48.9008 12.178 50.5568 12.178C52.3354 12.178 53.7078 12.7453 54.6738 13.88C55.6398 14.9993 56.1228 16.433 56.1228 18.181C56.1228 19.929 55.6244 21.3703 54.6278 22.505C53.6464 23.6397 52.2894 24.207 50.5568 24.207ZM50.5338 14.087C49.5371 14.087 48.7628 14.4857 48.2108 15.283C47.6588 16.065 47.3828 17.0387 47.3828 18.204C47.3828 19.354 47.6664 20.3277 48.2338 21.125C48.8011 21.907 49.5754 22.298 50.5568 22.298C51.5994 22.298 52.3891 21.9147 52.9258 21.148C53.4778 20.3813 53.7538 19.4077 53.7538 18.227C53.7538 17.0157 53.4931 16.0267 52.9718 15.26C52.4504 14.478 51.6378 14.087 50.5338 14.087ZM60.9172 7.739V14.34C61.5765 12.8987 62.7802 12.178 64.5282 12.178C65.6628 12.178 66.5752 12.5307 67.2652 13.236C67.9552 13.9413 68.3002 14.9227 68.3002 16.18V24H66.0462V16.64C66.0462 15.8427 65.8392 15.2293 65.4252 14.8C65.0265 14.3553 64.4975 14.133 63.8382 14.133C63.0715 14.133 62.3892 14.4243 61.7912 15.007C61.2085 15.5897 60.9172 16.479 60.9172 17.675V24H58.6632V7.739H60.9172ZM78.5761 17.33V16.916C78.5455 16.042 78.3078 15.352 77.8631 14.846C77.4185 14.3247 76.7821 14.064 75.9541 14.064C75.1875 14.064 74.5281 14.3477 73.9761 14.915C73.4241 15.467 73.0791 16.272 72.9411 17.33H78.5761ZM80.0251 21.355V23.379C79.1665 23.8697 78.0318 24.115 76.6211 24.115C74.8118 24.115 73.3705 23.5707 72.2971 22.482C71.2238 21.3933 70.6871 19.9673 70.6871 18.204C70.6871 16.3333 71.1778 14.869 72.1591 13.811C73.1405 12.7377 74.3901 12.201 75.9081 12.201C77.3955 12.201 78.5761 12.6687 79.4501 13.604C80.3241 14.524 80.7611 15.858 80.7611 17.606C80.7611 18.0813 80.7151 18.5797 80.6231 19.101H72.9641C73.1175 20.113 73.5468 20.8873 74.2521 21.424C74.9575 21.9607 75.8468 22.229 76.9201 22.229C78.1621 22.229 79.1971 21.9377 80.0251 21.355ZM93.6961 8.498V10.315L85.8531 22.045H94.0181V24H83.0701V22.137L90.8901 10.453H83.1851V8.498H93.6961ZM96.9388 24V12.339H99.2158V24H96.9388ZM97.0538 9.786C96.7931 9.51 96.6628 9.17267 96.6628 8.774C96.6628 8.37533 96.7931 8.038 97.0538 7.762C97.3298 7.486 97.6671 7.348 98.0658 7.348C98.4644 7.348 98.8018 7.486 99.0778 7.762C99.3538 8.038 99.4918 8.37533 99.4918 8.774C99.4918 9.15733 99.3538 9.487 99.0778 9.763C98.8018 10.039 98.4644 10.177 98.0658 10.177C97.6671 10.177 97.3298 10.0467 97.0538 9.786ZM104.738 12.339V14.34C105.428 12.8987 106.64 12.178 108.372 12.178C109.522 12.178 110.435 12.5307 111.109 13.236C111.784 13.9413 112.121 14.8997 112.121 16.111V24H109.867V16.64C109.867 15.8273 109.66 15.2063 109.246 14.777C108.848 14.3477 108.311 14.133 107.636 14.133C106.839 14.133 106.157 14.4473 105.589 15.076C105.022 15.6893 104.738 16.5557 104.738 17.675V24H102.484V12.339H104.738ZM121.799 12.73V14.777C121.048 14.3323 120.082 14.11 118.901 14.11C118.365 14.11 117.935 14.2327 117.613 14.478C117.307 14.7233 117.153 15.0453 117.153 15.444C117.153 15.5513 117.161 15.6587 117.176 15.766C117.207 15.858 117.253 15.9577 117.314 16.065C117.376 16.157 117.429 16.2413 117.475 16.318C117.537 16.3793 117.629 16.4483 117.751 16.525C117.874 16.6017 117.966 16.6707 118.027 16.732C118.104 16.778 118.219 16.8393 118.372 16.916C118.541 16.9927 118.664 17.054 118.74 17.1C118.817 17.1307 118.947 17.192 119.131 17.284C119.331 17.3607 119.469 17.4143 119.545 17.445C120.45 17.8437 121.155 18.296 121.661 18.802C122.183 19.2927 122.443 19.952 122.443 20.78C122.443 21.8227 122.075 22.643 121.339 23.241C120.603 23.8237 119.607 24.115 118.349 24.115C116.969 24.115 115.819 23.885 114.899 23.425V21.286C115.973 21.9453 117.084 22.275 118.234 22.275C118.832 22.275 119.292 22.1523 119.614 21.907C119.952 21.6617 120.12 21.3397 120.12 20.941C120.12 20.6037 119.99 20.3047 119.729 20.044C119.469 19.768 119.2 19.5687 118.924 19.446C118.664 19.308 118.211 19.101 117.567 18.825C115.743 18.0737 114.83 16.9697 114.83 15.513C114.83 14.4857 115.214 13.6807 115.98 13.098C116.747 12.5153 117.705 12.224 118.855 12.224C120.113 12.224 121.094 12.3927 121.799 12.73ZM132.033 17.33V16.916C132.003 16.042 131.765 15.352 131.32 14.846C130.876 14.3247 130.239 14.064 129.411 14.064C128.645 14.064 127.985 14.3477 127.433 14.915C126.881 15.467 126.536 16.272 126.398 17.33H132.033ZM133.482 21.355V23.379C132.624 23.8697 131.489 24.115 130.078 24.115C128.269 24.115 126.828 23.5707 125.754 22.482C124.681 21.3933 124.144 19.9673 124.144 18.204C124.144 16.3333 124.635 14.869 125.616 13.811C126.598 12.7377 127.847 12.201 129.365 12.201C130.853 12.201 132.033 12.6687 132.907 13.604C133.781 14.524 134.218 15.858 134.218 17.606C134.218 18.0813 134.172 18.5797 134.08 19.101H126.421C126.575 20.113 127.004 20.8873 127.709 21.424C128.415 21.9607 129.304 22.229 130.377 22.229C131.619 22.229 132.654 21.9377 133.482 21.355ZM139.126 12.339V14.34C139.816 12.8987 141.027 12.178 142.76 12.178C143.91 12.178 144.822 12.5307 145.497 13.236C146.172 13.9413 146.509 14.8997 146.509 16.111V24H144.255V16.64C144.255 15.8273 144.048 15.2063 143.634 14.777C143.235 14.3477 142.699 14.133 142.024 14.133C141.227 14.133 140.544 14.4473 139.977 15.076C139.41 15.6893 139.126 16.5557 139.126 17.675V24H136.872V12.339H139.126ZM149.057 23.724C148.766 23.4173 148.62 23.0493 148.62 22.62C148.62 22.1907 148.766 21.8303 149.057 21.539C149.364 21.2323 149.739 21.079 150.184 21.079C150.613 21.079 150.974 21.2323 151.265 21.539C151.572 21.8303 151.725 22.1907 151.725 22.62C151.725 23.0493 151.572 23.4173 151.265 23.724C150.974 24.0307 150.613 24.184 150.184 24.184C149.739 24.184 149.364 24.0307 149.057 23.724ZM160.128 18.802H158.38C157.522 18.802 156.87 18.9707 156.425 19.308C155.996 19.6453 155.781 20.0747 155.781 20.596C155.781 21.1327 155.95 21.5543 156.287 21.861C156.625 22.1677 157.115 22.321 157.759 22.321C158.495 22.321 159.07 22.1217 159.484 21.723C159.914 21.309 160.128 20.7723 160.128 20.113V18.802ZM154.263 15.122V12.937C155.168 12.4157 156.364 12.155 157.851 12.155C160.903 12.155 162.428 13.6347 162.428 16.594V24H160.197V22.62C159.599 23.6013 158.549 24.092 157.046 24.092C155.942 24.092 155.053 23.7777 154.378 23.149C153.719 22.505 153.389 21.6923 153.389 20.711C153.389 19.5917 153.811 18.7253 154.654 18.112C155.498 17.4833 156.678 17.169 158.196 17.169H160.128V16.502C160.128 15.7047 159.937 15.1067 159.553 14.708C159.17 14.294 158.534 14.087 157.644 14.087C156.402 14.087 155.275 14.432 154.263 15.122ZM168.386 14.087V20.504C168.386 21.6233 168.923 22.183 169.996 22.183C170.625 22.183 171.154 22.0143 171.583 21.677V23.701C171.077 23.977 170.456 24.115 169.72 24.115C167.313 24.115 166.109 22.896 166.109 20.458V14.087H164.292V12.339H166.109V9.487H168.386V12.339H171.445V14.087H168.386Z"
                          fill="white"/>
                </svg>

            </div>
            <p class="footer-tagline">
                Die aktuell h√∂chsten Zinsangebote f√ºr Ihr Erspartes ‚Äì transparent und objektiv.
            </p>
        </div>

        <!-- Sitemap Column -->
        <div class="footer-column">
            <h4>Sitemap</h4>
            <ul class="footer-links">
                <li><a href="#compare-section" onclick="handleCompareNav(event)">Compare</a></li>
                <li><a href="#faq-section">FAQs</a></li>
                <li><a href="#about-section">About</a></li>
            </ul>
        </div>

        <!-- Legal Column -->
        <div class="footer-column">
            <h4>Legal</h4>
            <ul class="footer-links">
                <li><a href="#terms">Terms and Conditions</a></li>
                <li><a href="#privacy">Privacy Policy</a></li>
            </ul>
        </div>
    </div>
    <hr>
    <!-- Copyright -->
    <div class="footer-copyright">
        ¬© 2025 HoheZinsen.at | All rights reserved.
    </div>
</footer>
<div class="comparison-status" id="comparisonStatus"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script th:inline="javascript">
    // ============================================================================
    // GLOBAL VARIABLES AND STATE
    // ============================================================================

    const isAuthenticated = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;

    let initialRates = /*[[${interestRates}]]*/ [];
    let initialTotalElements = /*[[${totalElements}]]*/ 0;
    let initialPageSize = /*[[${pageSize}]]*/ 5;

    let currentPage = 1;
    let pageSize = initialPageSize;
    let totalRecords = initialTotalElements;
    let totalPages = Math.ceil(totalRecords / pageSize);

    let currentSortColumn = /*[[${sortBy}]]*/ 'id';
    let currentSortDirection = /*[[${sortDir}]]*/ 'asc';
    let currentSearchTerm = /*[[${search}]]*/ '';

    let serverRateFieldValuesMap = /*[[${rateFieldValuesMap}]]*/ {};
    let globalFieldsCache = /*[[${globalFields}]]*/ [];
    let globalFieldsCompareCache = /*[[${globalFieldsCompare}]]*/ [];
    let allLoadedData = [...initialRates];

    let isLoading = false;
    let isLoadingMore = false;
    let hasMoreData = totalPages > 1;
    let currentExpandedCard = null;
    let currentEditForm = null;
    let isInitialLoadComplete = false;
    let comparedRates = new Map();
    let expandedRateCards = new Set();
    let maxComparisons = 3;

    let availableFilters = [];
    let activeFilters = new Map();
    let filterExpanded = false;

    // ============================================================================
    // FAQ TOGGLE
    // ============================================================================

    function toggleFaq(element) {
        const faqItem = element.closest('.faq-item');
        const isActive = faqItem.classList.contains('active');

        document.querySelectorAll('.faq-item').forEach(item => {
            item.classList.remove('active');
        });

        if (!isActive) {
            faqItem.classList.add('active');
        }
    }

    // ============================================================================
    // UTILITY FUNCTIONS (Loading, Comparisons, etc.)
    // ============================================================================

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    async function fetchMissingRateData(rateIds) {
        try {
            const promises = rateIds.map(rateId =>
                fetch(`/api/interest-rate/${rateId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to fetch rate ${rateId}`);
                        }
                        return response.json();
                    })
                    .then(rateData => {
                        if (rateData && rateData.fieldValues) {
                            serverRateFieldValuesMap[rateId] = rateData.fieldValues;
                        }
                        return rateData;
                    })
                    .catch(error => {
                        console.warn(`Could not fetch data for rate ${rateId}:`, error);
                        return null;
                    })
            );

            await Promise.all(promises);
            console.log('Successfully fetched missing rate data');
        } catch (error) {
            console.error('Error fetching missing rate data:', error);
        }
    }

    function maintainComparisonState() {
        comparedRates.forEach((rate, rateId) => {
            const externalCheckbox = document.getElementById(`external-compare-${rateId}`);
            if (externalCheckbox) {
                externalCheckbox.checked = true;
            }
            updateTableRowHighlight(rateId, true);
        });
        refreshAllVergleichenButtons();
    }

    function showLoading() {
        isLoading = true;
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) overlay.classList.add('show');
    }

    function hideLoading() {
        isLoading = false;
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) overlay.classList.remove('show');
    }

    function showDeleteNotification(message, isError) {
        const notification = document.getElementById('comparisonStatus');
        if (notification) {
            notification.textContent = message;
            notification.className = `comparison-status ${isError ? 'error' : 'success'}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    }

    function handleCompareNav(event) {
        if(event) event.preventDefault();

        const section = document.getElementById('compare-section');
        const btn = document.getElementById('quickCompareBtn');

        if (section) {
            section.scrollIntoView({ behavior: 'smooth' });

            if (btn && btn.offsetParent !== null && btn.style.display !== 'none') {
                setTimeout(() => {
                    quickStartComparison();
                }, 600);
            }
        }
    }

    function updateMaxComparisons() {
        const tableContainer = document.getElementById('tableContainer');
        const isMobileCardView = tableContainer && tableContainer.classList.contains('mobile-stack');
        maxComparisons = isMobileCardView ? 2 : 3;
    }

    function showStatus(message, type = 'success') {
        const status = document.getElementById('comparisonStatus');
        status.textContent = message;
        status.className = `comparison-status ${type}`;
        status.classList.add('show');

        setTimeout(() => {
            status.classList.remove('show');
        }, 3000);
    }

    function updateTableRowHighlight(rateId, highlight) {
        const row = document.querySelector(`tr[data-rate-id="${rateId}"]`);
        if (row) {
            if (highlight) {
                row.classList.add('table-row-selected');
                row.classList.add('just-selected');
                setTimeout(() => {
                    row.classList.remove('just-selected');
                }, 600);
            } else {
                row.classList.remove('table-row-selected', 'just-selected');
            }
        }
    }

    function updateVergleichenButtonVisibility(rateId, isInComparison) {
        const expandedCardButton = document.querySelector(`#rateCard_${rateId} button[onclick*="startComparisonFromCard(${rateId})"]`);
        const mobileCardButton = document.querySelector(`div[data-rate-id="${rateId}"] button[onclick*="startComparisonFromCard(${rateId})"]`);

        const buttons = [expandedCardButton, mobileCardButton].filter(btn => btn !== null);

        buttons.forEach(button => {
            if (isInComparison) {
                button.style.display = 'none';
            } else {
                button.style.display = 'inline-block';
            }
        });
    }

    function refreshAllVergleichenButtons() {
        const allRateIds = new Set(allLoadedData.map(rate => rate.id));

        allRateIds.forEach(rateId => {
            const isInComparison = comparedRates.has(rateId);
            updateVergleichenButtonVisibility(rateId, isInComparison);
        });
    }

    // ============================================================================
    // LOAD MORE DATA LOGIC
    // ============================================================================

    function updateLoadMoreButtonState() {
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const loadingMoreIndicator = document.getElementById('loadingMoreIndicator');
        const endOfDataIndicator = document.getElementById('endOfDataIndicator');

        if (isLoadingMore) {
            if (loadMoreBtn) loadMoreBtn.style.display = 'none';
            if (loadingMoreIndicator) loadingMoreIndicator.style.display = 'block';
            if (endOfDataIndicator) endOfDataIndicator.style.display = 'none';
        } else if (hasMoreData) {
            if (loadMoreBtn) {
                loadMoreBtn.style.display = 'inline-block';
                loadMoreBtn.disabled = false;
            }
            if (loadingMoreIndicator) loadingMoreIndicator.style.display = 'none';
            if (endOfDataIndicator) endOfDataIndicator.style.display = 'none';
        } else {
            if (loadMoreBtn) loadMoreBtn.style.display = 'none';
            if (loadingMoreIndicator) loadingMoreIndicator.style.display = 'none';
            if (endOfDataIndicator) endOfDataIndicator.style.display = 'block';
        }
    }

    function updateResultsInfo() {
        const infoFooter = document.getElementById('resultsInfoFooter');
        const endRecord = allLoadedData.length;

        const infoText = `Showing ${endRecord} of ${totalRecords} results`;
        if (infoFooter) infoFooter.textContent = infoText;
    }

    async function loadMoreData() {
        if (isLoadingMore || !hasMoreData || isLoading) return;

        const nextPage = Math.floor(allLoadedData.length / pageSize) + 1;

        if (nextPage > totalPages) {
            hasMoreData = false;
            updateLoadMoreButtonState();
            return;
        }

        isLoadingMore = true;
        updateLoadMoreButtonState();

        try {
            const data = await fetchPageData(nextPage, currentSearchTerm, currentSortColumn, currentSortDirection);

            if (data && data.content && data.content.length > 0) {
                const existingIds = new Set(allLoadedData.map(r => r.id));
                const uniqueNewContent = data.content.filter(r => !existingIds.has(r.id));

                if (uniqueNewContent.length > 0) {
                    totalPages = data.totalPages;
                    totalRecords = data.totalElements;

                    allLoadedData = [...allLoadedData, ...uniqueNewContent];

                    Object.assign(serverRateFieldValuesMap, data.rateFieldValuesMap || {});

                    renderTableData(uniqueNewContent, true);

                    updateResultsInfo();
                }

                hasMoreData = allLoadedData.length < totalRecords;

                const currentRateIds = new Set(data.content.map(rate => rate.id));
                const comparedRatesNeedingData = [];
                comparedRates.forEach((rate, rateId) => {
                    if (!currentRateIds.has(rateId) && !serverRateFieldValuesMap[rateId]) {
                        comparedRatesNeedingData.push(rateId);
                    }
                });

                if (comparedRatesNeedingData.length > 0) {
                    await fetchMissingRateData(comparedRatesNeedingData);
                    updateComparisonDisplay();
                }

                maintainComparisonState();
            } else {
                hasMoreData = false;
            }
        } catch (error) {
            console.error('Error loading more data:', error);
            showDeleteNotification('Error loading more data: ' + error.message, true);
        } finally {
            isLoadingMore = false;
            updateLoadMoreButtonState();
        }
    }

    async function fetchPageData(page, searchTerm = '', sortBy = null, sortDir = null) {
        const params = new URLSearchParams({
            page: page - 1,
            size: pageSize,
            sortBy: sortBy || currentSortColumn,
            sortDir: sortDir || currentSortDirection
        });

        if (searchTerm && searchTerm.trim()) {
            params.append('search', searchTerm.trim());
        }

        if (typeof activeFilters !== 'undefined' && activeFilters.size > 0) {
            activeFilters.forEach((values, fieldId) => {
                if (values.size > 0) {
                    const filterValue = Array.from(values).join('|');
                    params.set(`filter_${fieldId}`, encodeURIComponent(filterValue));
                }
            });
        }

        const response = await fetch(`/api/interest-rates?${params.toString()}`);

        if (!response.ok) {
            throw new Error('Failed to fetch data');
        }

        return await response.json();
    }

    async function reloadDataFromServer(searchTerm = '', sortBy = null, sortDir = null) {
        if (isLoading) return;

        showLoading();
        isLoadingMore = true;
        updateLoadMoreButtonState();

        try {
            const data = await fetchPageData(1, searchTerm, sortBy, sortDir);

            currentPage = 1;
            totalPages = data.totalPages;
            totalRecords = data.totalElements;
            currentSearchTerm = searchTerm || '';
            currentSortColumn = sortBy || currentSortColumn;
            currentSortDirection = sortDir || currentSortDirection;
            pageSize = data.size || pageSize;

            allLoadedData = data.content;
            Object.assign(serverRateFieldValuesMap, data.rateFieldValuesMap || {});

            renderTableData(allLoadedData, false);

            updateResultsInfo();
            hasMoreData = allLoadedData.length < totalRecords;
            updateLoadMoreButtonState();

            if (currentExpandedCard) closeExpandedCard(currentExpandedCard);
            maintainComparisonState();

            updateBrowserUrlWithFilters();

        } catch (error) {
            console.error('Error loading page:', error);
            showDeleteNotification('Error loading data: ' + error.message, true);
        } finally {
            hideLoading();
            isLoadingMore = false;
            updateLoadMoreButtonState();
        }
    }

    // ============================================================================
    // INITIALIZATION AND DOCUMENT READY
    // ============================================================================

    document.addEventListener('DOMContentLoaded', function () {
        totalPages = Math.ceil(totalRecords / pageSize);
        hasMoreData = totalPages > 1;

        initializeComparisonState();
        initializeSortableHeaders();
        initializeMobileViewToggle();

        renderTableData(allLoadedData, false);

        updateResultsInfo();
        updateLoadMoreButtonState();

        isInitialLoadComplete = true;

        initializeFilters();
    });

    function initializeComparisonState() {
        window.addEventListener('resize', debounce(updateMaxComparisons, 250));
        updateMaxComparisons();
    }

    function initializeSortableHeaders() {
        document.querySelectorAll('.draggable-column, .sortable').forEach(header => {
            header.classList.add('sortable');
        });
    }

    function initializeMobileViewToggle() {
        const stackedViewBtn = document.getElementById('stackedView');
        const scrollViewBtn = document.getElementById('scrollView');
        const tableContainer = document.getElementById('tableContainer');
        const isMobile = window.innerWidth <= 768;

        if (stackedViewBtn && scrollViewBtn && tableContainer) {
            // Initial state based on screen size
            if (isMobile) {
                tableContainer.classList.add('mobile-stack');
                stackedViewBtn.classList.add('active');
                scrollViewBtn.classList.remove('active');
            } else {
                tableContainer.classList.remove('mobile-stack');
                scrollViewBtn.classList.add('active');
                stackedViewBtn.classList.remove('active');
            }

            stackedViewBtn.addEventListener('click', function() {
                tableContainer.classList.add('mobile-stack');
                stackedViewBtn.classList.add('active');
                scrollViewBtn.classList.remove('active');
                renderTableData(allLoadedData, false);
                updateMaxComparisons();
            });

            scrollViewBtn.addEventListener('click', function() {
                tableContainer.classList.remove('mobile-stack');
                scrollViewBtn.classList.add('active');
                stackedViewBtn.classList.remove('active');
                renderTableData(allLoadedData, false);
                updateMaxComparisons();
            });
        }
    }

    // ============================================================================
    // TABLE RENDERING AND DATA DISPLAY
    // ============================================================================

    function renderTableData(data, append = false) {
        const tbody = document.getElementById('tableBody');
        const emptyState = document.getElementById('emptyState');
        const tableContainer = document.getElementById('tableContainer');

        const isMobileCardView = tableContainer && tableContainer.classList.contains('mobile-stack');

        if (!allLoadedData || allLoadedData.length === 0) {
            tbody.innerHTML = '';
            emptyState.style.display = 'block';
            updateExternalCheckboxes([]);
            return;
        }

        emptyState.style.display = 'none';

        const contentHtml = isMobileCardView ? renderMobileCardsHTML(data) : renderTableRowsHTML(data);

        if (append) {
            tbody.insertAdjacentHTML('beforeend', contentHtml);
        } else {
            const allContentHtml = isMobileCardView ? renderMobileCardsHTML(allLoadedData) : renderTableRowsHTML(allLoadedData);
            tbody.innerHTML = allContentHtml;
        }

        if (document.body.classList.contains('comparison-mode')) {
            setTimeout(() => {
                alignExternalCheckboxes();
            }, 50);
        }

        maintainComparisonState();
    }

    function renderMobileCardsHTML(data) {
        return data.map(rate => createMobileCard(rate)).join('');
    }

function renderTableRowsHTML(data) {
        if (!data || data.length === 0) return '';

        const headers = document.querySelectorAll('.draggable-column, .sortable');
        const currentFieldOrder = Array.from(headers)
            .map(header => ({
                id: header.dataset.fieldId,
                fieldKey: header.dataset.fieldKey,
                label: header.querySelector('.header-text').textContent.trim()
            }));

        return data.map(rate => {
            const isSelected = comparedRates.has(rate.id);

            const fieldCells = currentFieldOrder.map((field, index) => {
                const fieldValue = serverRateFieldValuesMap[rate.id]?.[field.id] || '';

                if (field.fieldKey && field.fieldKey.toLowerCase().includes('img')) {
                    return `
                        <td class="data-cell image-cell" data-field-id="${field.id}" data-label="${field.label}">
                            <div class="image-container">
                                ${fieldValue ? `<img src="${fieldValue}" alt="Interest Rate Logo" class="interest-rate-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" />` : ''}
                                <div class="no-image-placeholder" style="${fieldValue ? 'display:none' : 'display:block'}">No Image</div>
                            </div>
                        </td>
                    `;
                }
                else if (index === 0) {
                    return `
                        <td class="data-cell" data-field-id="${field.id}" data-label="${field.label}">
                            <div class="rate-wrapper">
                                <span class="rate-number">${fieldValue || '0,00'}</span>
                                <div class="rate-suffix">
                                    <span class="symbol">%</span>
                                    <span class="pa-text">p.a.</span>
                                </div>
                            </div>
                        </td>
                    `;
                }
                else {
                    return `
                        <td class="data-cell" data-field-id="${field.id}" data-label="${field.label}">
                            <div class="form-control form-control-sm text-center"
                                 style="border: none; background: transparent; cursor: default;">
                                ${fieldValue || '-'}
                            </div>
                        </td>
                    `;
                }
            }).join('');

            const isExpanded = expandedRateCards.has(rate.id);
            const actionButtons = `
                <div class="action-buttons">
                    <button class="mehr-info-btn"
                            ${rate.moreInfo ? '' : 'disabled'}
                            onclick="showMoreInfo(${rate.id})"
                            title="${isExpanded ? 'Hide info' : (rate.moreInfo ? 'Show more info' : 'No additional info available')}">
                        ${rate.moreInfo ?
                            (isExpanded ?
                                `<svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14.9995 9L7.99951 2L0.999512 9" stroke="#00AC98" stroke-width="2"/>
                                </svg>` :
                                `MEHR INFO <svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M1 1L8 8L15 1" stroke="#00AC98" stroke-width="2"/>
                                </svg>`
                            ) :
                            'No Info'
                        }
                    </button>
                </div>
            `;

            return `
                <tr data-rate-id="${rate.id}" ${isSelected ? 'class="table-row-selected"' : ''}>
                    ${fieldCells}
                    <td data-label="Actions">
                        ${actionButtons}
                    </td>
                </tr>
            `;
        }).join('');
    }

    // ============================================================================
    // SEARCH, SORT, AND FILTER
    // ============================================================================

    function performSearch() {
        const searchInput = document.getElementById('searchInput');
        const searchTerm = searchInput ? searchInput.value.trim() : '';
        reloadDataFromServer(searchTerm, currentSortColumn, currentSortDirection);
    }

    function clearSearch() {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.value = '';
        }
        reloadDataFromServer('', currentSortColumn, currentSortDirection);
    }

    function sortTable(headerElement, event) {
        if (event && event.type === 'click' && headerElement.classList.contains('dragging')) {
            return;
        }

        const fieldId = headerElement.dataset.fieldId;
        const sortBy = `field_${fieldId}`;

        let sortDirection = 'asc';
        if (currentSortColumn === sortBy) {
            sortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
        }

        document.querySelectorAll('.sortable')
            .forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
        headerElement.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');

        reloadDataFromServer(currentSearchTerm, sortBy, sortDirection);
    }

    function applyFilters() {
        const searchInput = document.getElementById('searchInput');

        if (activeFilters.size > 0) {
            if (searchInput) {
                searchInput.value = '';
            }
            reloadDataFromServer('', currentSortColumn, currentSortDirection);
        } else {
            reloadDataFromServer(currentSearchTerm, currentSortColumn, currentSortDirection);
        }

        updateBrowserUrlWithFilters();
        if (window.innerWidth <= 768) {
            toggleFilters();
        }
    }

    function clearAllFilters() {
        activeFilters.clear();
        updateFilterCheckboxes();
        updateActiveFiltersDisplay();

        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.value = currentSearchTerm;
        }

        reloadDataFromServer(currentSearchTerm, currentSortColumn, currentSortDirection);

        updateBrowserUrlWithFilters();
    }

    function removeFilterTag(fieldId, value) {
        if (activeFilters.has(fieldId)) {
            activeFilters.get(fieldId).delete(value);
            if (activeFilters.get(fieldId).size === 0) {
                activeFilters.delete(fieldId);
            }
        }
        updateFilterCheckboxes();
        updateActiveFiltersDisplay();
        applyFilters();
    }


    function initializeFilters() {
        fetch('/filters/available')
            .then(response => {
                if (response.ok) return response.json();
                throw new Error('Failed to load filters');
            })
            .then(data => {
                availableFilters = data;
                renderFilterGrid();
                initializeFromUrlParams();
            })
            .catch(error => {
                console.error('Error loading filters:', error);
            });
    }

    function initializeFromUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);

        for (const [key, value] of urlParams.entries()) {
            if (key.startsWith('filter_')) {
                const fieldId = key.substring(7);
                const decodedValue = decodeURIComponent(value);
                const values = decodedValue.includes('|') ? decodedValue.split('|') : [decodedValue];
                activeFilters.set(fieldId, new Set(values));
            }
        }

        if (activeFilters.size > 0) {
            updateActiveFiltersDisplay();
            updateFilterCheckboxes();
        }
    }

    function toggleFilters() {
        const content = document.getElementById('filterContent');
        const toggle = document.getElementById('filterToggle');
        filterExpanded = !filterExpanded;
        if (filterExpanded) {
            content.classList.add('show');
            toggle.classList.add('expanded');
        } else {
            content.classList.remove('show');
            toggle.classList.remove('expanded');
        }
    }

    function renderFilterGrid() {
        const grid = document.getElementById('filterGrid');

        grid.innerHTML = availableFilters.map(filter => {
            const fieldIdStr = filter.fieldId.toString();
            const currentSelection = Array.from(activeFilters.get(fieldIdStr) || []).join('');

            let selectHtml = `
                <div style="position: relative; display: inline-block;">
                    <select
                        class="filter-dropdown-pill"
                        onchange="updateFilterFromDropdown(this, ${filter.fieldId})"
                        data-field-id="${filter.fieldId}"
                        style="padding-right: 30px; appearance: none; -webkit-appearance: none; -moz-appearance: none; background: transparent;">
                    <option value="">Alle</option>
            `;

            selectHtml += filter.options.map(option => `
                <option
                    value="${option.value}"
                    ${option.value === currentSelection ? 'selected' : ''}>
                    ${option.label}
                </option>
            `).join('');

            selectHtml += `
                    </select>
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="6" viewBox="0 0 12 6" fill="none"
                         style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); pointer-events: none;">
                        <path d="M6 6L0 0H12L6 6Z" fill="currentColor"/>
                    </svg>
                </div>
            `;

            return `
                <div class="filter-item" data-field-id="${filter.fieldId}">
                    <h6>${filter.label}</h6>
                    ${selectHtml}
                </div>
            `;
        }).join('');
    }

    function updateFilterFromDropdown(selectElement, fieldId) {
        const fieldIdStr = fieldId.toString();
        const value = selectElement.value;

        // Clear previous selection for this field
        activeFilters.delete(fieldIdStr);

        // Add new selection if it's not the default 'All' option (value == '')
        if (value !== '') {
            activeFilters.set(fieldIdStr, new Set([value]));
        }

        applyFilters();
    }

    function toggleFilterOption(fieldId, value) {
        const fieldIdStr = fieldId.toString();

        if (!activeFilters.has(fieldIdStr)) {
            activeFilters.set(fieldIdStr, new Set());
        }

        const fieldFilters = activeFilters.get(fieldIdStr);

        if (fieldFilters.has(value)) {
            fieldFilters.delete(value);
            if (fieldFilters.size === 0) {
                activeFilters.delete(fieldIdStr);
            }
        } else {
            fieldFilters.add(value);
        }

        updateFilterCheckboxes();
        updateActiveFiltersDisplay();
    }

    function updateFilterCheckboxes() {
        availableFilters.forEach(filter => {
            const fieldIdStr = filter.fieldId.toString();
            const selectedValues = activeFilters.get(fieldIdStr) || new Set();

            filter.options.forEach(option => {
                const checkboxId = `filter_${filter.fieldId}_${option.value.replace(/[^a-zA-Z0-9]/g, '_')}`;
                const checkbox = document.getElementById(checkboxId);
                if (checkbox) {
                    checkbox.checked = selectedValues.has(option.value);
                }
            });
        });
    }

    function updateActiveFiltersDisplay() {
        const container = document.getElementById('activeFilters');
        const tags = [];

        activeFilters.forEach((values, fieldId) => {
            const filter = availableFilters.find(f => f.fieldId.toString() === fieldId);
            if (filter) {
                values.forEach(value => {
                    tags.push(`
                        <span class="filter-tag">
                            ${filter.label}: ${value}
                            <button class="remove-filter" onclick="removeFilterTag('${fieldId}', '${value}')" title="Remove filter">
                                ‚úï
                            </button>
                        </span>
                    `);
                });
            }
        });

        container.innerHTML = tags.join('');
        container.style.display = tags.length > 0 ? 'flex' : 'none';
    }

    function updateBrowserUrlWithFilters() {
        const url = new URL(window.location);
        url.search = '';
        const params = new URLSearchParams();
        params.set('sortBy', currentSortColumn);
        params.set('sortDir', currentSortDirection);
        params.set('size', pageSize);
        if (currentSearchTerm) {
            params.set('search', currentSearchTerm);
        }
        const sortedFilters = Array.from(activeFilters.entries()).sort((a, b) => a[0] - b[0]);
        sortedFilters.forEach(([fieldId, values]) => {
            if (values.size > 0) {
                const filterValue = Array.from(values).join('|');
                params.set(`filter_${fieldId}`, encodeURIComponent(filterValue));
            }
        });
        url.search = params.toString();
        window.history.replaceState({}, '', url);
    }

    // ============================================================================
    // COMPARISON & MORE INFO
    // ============================================================================

    function toggleComparison(rateId, isChecked) {
        if (isChecked) {
            addToComparison(rateId);
        } else {
            removeFromComparison(rateId);
        }
    }

    function addToComparison(rateId) {
        updateMaxComparisons();

        if (comparedRates.size >= maxComparisons) {
            const maxText = maxComparisons === 2 ? '2' : '3';
            showStatus(`Maximum number of comparisons reached (${maxText})`, 'warning');
            const checkbox = document.getElementById(`external-compare-${rateId}`);
            if (checkbox) checkbox.checked = false;
            return;
        }

        let rate = allLoadedData.find(r => r.id === rateId);

        if (rate && !comparedRates.has(rateId)) {
            comparedRates.set(rateId, rate);

            if (!serverRateFieldValuesMap[rateId]) {
                fetchMissingRateData([rateId]).then(() => {
                    updateComparisonDisplay();
                });
            } else {
                updateComparisonDisplay();
            }

            updateTableRowHighlight(rateId, true);
            updateVergleichenButtonVisibility(rateId, true);

            const providerName = serverRateFieldValuesMap[rateId]?.[1] || `Rate #${rateId}`;
            showStatus(`${providerName} added to comparison`, 'success');
        }
    }

    function removeFromComparison(rateId) {
        if (comparedRates.has(rateId)) {
            comparedRates.delete(rateId);
            updateComparisonDisplay();
            updateTableRowHighlight(rateId, false);

            updateVergleichenButtonVisibility(rateId, false);

            showStatus(`Aus dem Vergleich entfernt`, 'info');

            const externalCheckbox = document.getElementById(`external-compare-${rateId}`);
            if (externalCheckbox) {
                externalCheckbox.checked = false;
            }

            if (comparedRates.size === 0) {
                document.body.classList.remove('comparison-mode');
                const externalCheckboxes = document.getElementById('externalCheckboxes');
                if (externalCheckboxes) {
                    externalCheckboxes.innerHTML = '';
                }
                const quickCompareBtn = document.getElementById('quickCompareBtn');
                if (quickCompareBtn) {
                    quickCompareBtn.style.display = "inline-block";
                }
            }
        }
    }

    function clearAllComparisons() {
        document.querySelectorAll('.external-checkbox').forEach(checkbox => {
            checkbox.checked = false;
        });

        comparedRates.forEach((rate, rateId) => {
            updateTableRowHighlight(rateId, false);
            updateVergleichenButtonVisibility(rateId, false);
        });

        comparedRates.clear();
        updateComparisonDisplay();
        showStatus('All comparisons cleared', 'info');
        document.body.classList.remove('comparison-mode');

        // Hide the external checkboxes
        const externalCheckboxes = document.getElementById('externalCheckboxes');
        if (externalCheckboxes) {
            externalCheckboxes.innerHTML = '';
            externalCheckboxes.style.display = 'none';
        }

        const quickCompareBtn = document.getElementById('quickCompareBtn');
        if (quickCompareBtn) {
            quickCompareBtn.style.display = "inline-block";
        }
    }

    function updateComparisonDisplay() {
        const section = document.getElementById('comparisonSection');
        const container = document.getElementById('comparisonContainer');
        const emptyState = document.getElementById('emptyComparisonState');

        if (comparedRates.size === 0) {
            section.style.display = 'none';
            document.getElementById("quickCompareBtn").style.display = "inline-block";
            return;
        }

        section.style.display = 'block';
        emptyState.style.display = 'none';

        container.innerHTML = createComparisonLayout();
    }

    function createComparisonLayout() {
        const tableContainer = document.getElementById('tableContainer');
        const isMobileCardView = tableContainer && tableContainer.classList.contains('mobile-stack');

        if (isMobileCardView) {
            return createMobileComparisonLayout();
        } else {
            return createDesktopComparisonLayout();
        }
    }

    function createMobileComparisonLayout() {
        const cardsHtml = `
            <div class="mobile-comparison-container">
                ${Array.from(comparedRates.entries()).map(([rateId, rate]) =>
                    createMobileComparisonCard(rate)
                ).join('')}
                ${comparedRates.size < 2 ? createEmptyMobileComparisonCard() : ''}
            </div>
        `;
        return cardsHtml;
    }

    function createMobileComparisonCard(rate) {
        const rateFieldValues = serverRateFieldValuesMap[rate.id] || {};

        if (Object.keys(rateFieldValues).length === 0) {
            fetchMissingRateData([rate.id]).then(() => {
                updateComparisonDisplay();
            });
            return `
                <div class="mobile-comparison-card">
                    <div class="mobile-comparison-header">
                        <span class="mobile-provider-name">Loading...</span>
                        <button class="mobile-remove-btn" onclick="removeFromComparison(${rate.id})">‚úï</button>
                    </div>
                </div>
            `;
        }

        const providerName = rateFieldValues[globalFieldsCompareCache[1]?.id] || 'Provider';

        let logoHtml = '<span style="color: #999;">(logo)</span>';
        const imageField = globalFieldsCompareCache.find(
            f => f.fieldKey && f.fieldKey.toLowerCase().includes("img")
        );
        if (imageField) {
            const imageUrl = rateFieldValues[imageField.id];
            if (imageUrl && imageUrl !== "-") {
                logoHtml = `<img src="${imageUrl}" alt="Logo" style="max-height: 70px; max-width: 140px; object-fit: contain;">`;
            }
        }

        const fieldRows = globalFieldsCompareCache
            .filter(field => !(field.fieldKey && field.fieldKey.toLowerCase().includes("img")))
            .map(field => {
                const value = rateFieldValues[field.id] || "-";
                return `
                    <div class="mobile-field-row">
                        <div class="mobile-field-label">${field.label.toUpperCase()}</div>
                        <div class="mobile-field-value">${value}</div>
                    </div>
                `;
            }).join('');

        return `
            <div class="mobile-comparison-card">
                <div class="mobile-comparison-header">
                    <button class="mobile-remove-btn" onclick="removeFromComparison(${rate.id})" title="Remove">‚úï</button>
                </div>
                <div class="mobile-logo-section">
                    ${logoHtml}
                </div>
                <div class="mobile-comparison-fields">
                    ${fieldRows}
                </div>
                <div class="mobile-mehr-info-section">
                    <a href="javascript:void(0)"
                       class="${rate.moreInfo ? 'mobile-mehr-link' : 'mobile-mehr-link disabled'}"
                       onclick="${rate.moreInfo ? `showMoreInfo(${rate.id})` : 'return false;'}"
                       style="${rate.moreInfo ? 'color: #00b894;' : 'color: #ccc; pointer-events: none;'}">
                        ${rate.moreInfo ? 'MEHR INFO' : 'No Info'}
                    </a>
                </div>
            </div>
        `;
    }

    function createEmptyMobileComparisonCard() {
        return `
            <div class="mobile-comparison-card empty">
                <div class="empty-card-content">
                    <p style="font-size: 13px; color: #666; text-align: center; margin: 0;">
                        Click a provider<br>to compare
                    </p>
                </div>
            </div>
        `;
    }

    function createDesktopComparisonLayout() {
        const labelsHtml = `
            <div class="comparison-labels">
                ${globalFieldsCompareCache
                    .filter(field => !(field.fieldKey && field.fieldKey.toLowerCase().includes("img")))
                    .map(field => `
                        <div class="comparison-label-row">${field.label}</div>
                    `).join('')}
            </div>
        `;

        const cardsHtml = `
            <div class="comparison-cards-container">
                ${Array.from(comparedRates.entries()).map(([rateId, rate], index) =>
                    createComparisonCardNew(rate, index === 0)
                ).join('')}
                ${comparedRates.size < maxComparisons ? createEmptyComparisonCards(maxComparisons - comparedRates.size) : ''}
            </div>
        `;

        return labelsHtml + cardsHtml;
    }

    function createEmptyComparisonCards(count) {
        let cards = '';
        for (let i = 0; i < count; i++) {
            cards += `
                <div class="empty-comparison-card">
                    click a provider from the table<br>below to add to compare
                </div>
            `;
        }
        return cards;
    }

    function createComparisonCardNew(rate, isFirstCard = false) {
        const rateFieldValues = serverRateFieldValuesMap[rate.id] || {};

        if (Object.keys(rateFieldValues).length === 0) {
            fetchMissingRateData([rate.id]).then(() => {
                updateComparisonDisplay();
            });

            return `
                <div class="comparison-card">
                    <div class="comparison-card-header">
                        <div class="provider-info">
                            <span class="provider-name">Loading Rate #${rate.id}...</span>
                        </div>
                        <button class="remove-comparison" onclick="removeFromComparison(${rate.id})" title="Remove">
                            ‚úï
                        </button>
                    </div>
                    <div class="comparison-values">
                        ${globalFieldsCompareCache.map((_, index) => `
                            <div class="comparison-value-row ${index % 2 === 0 ? 'row-even' : 'row-odd'}">Loading...</div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        let headerImage = null;
        let headerImageFieldId = null;
        const imageField = globalFieldsCompareCache.find(
            f => f.fieldKey && f.fieldKey.toLowerCase().includes("img")
        );

        if (imageField) {
            const imageUrl = rateFieldValues[imageField.id];
            if (imageUrl && imageUrl !== "-") {
                headerImageFieldId = imageField.id;
                headerImage = `<img src="${imageUrl}" alt="Logo" class="comparison-logo"
                                  style="height: 60px; width: auto; object-fit: contain;">`;
            }
        }

        const valueRows = globalFieldsCompareCache
            .filter(field => field.id !== headerImageFieldId && !(field.fieldKey && field.fieldKey.toLowerCase().includes("img")))
            .map((field, index) => {
                const value = rateFieldValues[field.id] || "-";
                const rowClass = index % 2 === 0 ? 'row-even' : 'row-odd';
                return `<div class="comparison-value-row ${rowClass}" data-label="${field.label}">${value}</div>`;
            }).join("");

        const checkmarkSvg = isFirstCard ? `
            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="position: absolute; left: -15px; top: 31px;">
              <rect width="24" height="24" rx="12" fill="#F4F4F4"></rect>
              <path d="M5 9.5L11.5 16L22.5 5" stroke="#01AC99" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        ` : '';

        return `
            <div class="comparison-card">
                ${checkmarkSvg}
                <div class="comparison-card-header">
                    <div class="provider-info d-flex align-items-center">
                        ${headerImage || '<span class="text-muted">No Logo</span>'}
                    </div>
                    <button class="remove-comparison" onclick="removeFromComparison(${rate.id})" title="Remove">
                        ‚úï
                    </button>
                </div>
                <div class="comparison-values">
                    ${valueRows}
                    <div style="display: flex; justify-content: center; align-items: center; padding-top: 16px; padding-bottom: 16px;">
                       <a href="javascript:void(0)"
                           class="${rate.moreInfo ? '' : 'disabled'}"
                           onclick="${rate.moreInfo ? `showMoreInfo(${rate.id})` : 'return false;'}"
                           title="${rate.moreInfo ? 'Show more info' : 'No additional info available'}"
                           style="font-weight: bold; color: ${rate.moreInfo ? '#00b894' : '#ccc'}; text-decoration: none; cursor: pointer;">
                            ${rate.moreInfo ? 'MEHR INFO' : 'No Info'}
                       </a>
                    </div>
                </div>
            </div>
        `;
    }

    function showMoreInfo(rateId) {
        let rate = allLoadedData.find(r => r.id === rateId);

        if (expandedRateCards.has(rateId)) {
            closeExpandedCard(rateId);
            expandedRateCards.delete(rateId);
            updateMehrInfoButton(rateId, false);
            alignExternalCheckboxes();
            return;
        }

        if (!rate) {
            showStatus('Rate data not found locally, fetching details...', 'info');
            fetchRateDetails(rateId).then(rateData => {
                if (rateData && rateData.moreInfo) {
                    if (rateData.fieldValues) {
                        serverRateFieldValuesMap[rateId] = rateData.fieldValues;
                    }
                    if (!allLoadedData.find(r => r.id === rateId)) {
                        allLoadedData.push(rateData);
                    }
                    displayRateCard(rateData);
                } else {
                    showStatus('No additional information available for this rate.', 'warning');
                }
            });
            return;
        }

        if (!rate.moreInfo) {
            showStatus('No additional information available for this rate.', 'warning');
            return;
        }

        if (currentExpandedCard && currentExpandedCard !== rateId) {
            closeExpandedCard(currentExpandedCard);
            expandedRateCards.delete(currentExpandedCard);
            updateMehrInfoButton(currentExpandedCard, false);
        }

        displayRateCard(rate);
        expandedRateCards.add(rateId);
        updateMehrInfoButton(rateId, true);
        alignExternalCheckboxes();
    }

    function displayRateCard(rate) {
        let existingCard = document.getElementById(`rateCardRow_${rate.id}`);
        if (existingCard) {
            existingCard.style.display = 'none';
            setTimeout(() => {
                if (existingCard.parentNode) {
                    existingCard.parentNode.removeChild(existingCard);
                }
            }, 0);

            if (currentExpandedCard === rate.id) {
                currentExpandedCard = null;
                return;
            }
        }

        const tableContainer = document.getElementById('tableContainer');
        const isMobileCardView = tableContainer && tableContainer.classList.contains('mobile-stack');

        let targetElement = document.querySelector(isMobileCardView ? `div.mobile-interest-card[data-rate-id="${rate.id}"]` : `tr[data-rate-id="${rate.id}"]`);

        if (!targetElement) {
            console.error('Target element not found for rate ID:', rate.id);
            return;
        }

        const card = createRateCard(rate);

        if (isMobileCardView) {
            card.style.borderTop = 'none';
            card.style.borderRadius = '0 0 12px 12px';
            card.style.marginTop = '0';
            targetElement.appendChild(card);
            targetElement.classList.add('card-expanded');
        } else {
            const cardContainer = document.createElement('tr');
            cardContainer.id = `rateCardRow_${rate.id}`;
            cardContainer.className = 'rate-card-row show';
            cardContainer.innerHTML = `<td colspan="100%" class="rate-card-cell"></td>`;
            cardContainer.querySelector('.rate-card-cell').appendChild(card);
            targetElement.insertAdjacentElement('afterend', cardContainer);
        }

        setTimeout(() => {
            if (isMobileCardView) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });
            } else {
                const cardRow = document.getElementById(`rateCardRow_${rate.id}`);
                if (cardRow) {
                    cardRow.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }
            }
        }, 50);

        currentExpandedCard = rate.id;
    }

    function createRateCard(rate) {
        const card = document.createElement('div');
        card.className = 'rate-card';
        card.id = `rateCard_${rate.id}`;

        const moreInfo = rate.moreInfo;
        if (!moreInfo) return card;

        const sectionOrder = moreInfo.sectionOrder || [];
        const tableSectionsMap = new Map();
        const textSectionsMap = new Map();

        if (moreInfo.tableSections) {
            moreInfo.tableSections.forEach(tableSection => {
                tableSectionsMap.set(tableSection.sectionIdentifier, tableSection);
            });
        }

        if (moreInfo.textSections) {
            moreInfo.textSections.forEach(textSection => {
                textSectionsMap.set(textSection.sectionIdentifier, textSection);
            });
        }

        const createTableSection = (tableSection) => {
            if (!tableSection || !tableSection.title || !tableSection.miniTableRows || tableSection.miniTableRows.length === 0) {
                return '';
            }
            return `
                <div class="expanded-section ${isAuthenticated ? 'draggable-section' : ''} table-section"
                     data-section-type="table"
                     data-section-id="${tableSection.sectionIdentifier}">
                    <h5 class="section-title">${tableSection.title}</h5>
                    <div class="info-table">
                        ${tableSection.miniTableRows.map(row => `
                            <div class="info-table-row">
                                <div class="info-table-label">${row.label || ''}</div>
                                <div class="info-table-value">${row.description || ''}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        const createTextSection = (textSection) => {
            if (!textSection || (!textSection.title && !textSection.content)) {
                return '';
            }

            return `
                <div class="expanded-section ${isAuthenticated ? 'draggable-section' : ''} text-section"
                     data-section-type="text"
                     data-section-id="${textSection.sectionIdentifier}">
                    ${textSection.title ? `<h5 class="section-title">${textSection.title}</h5>` : ''}
                    <div class="text-content" style="text-align: left;">${textSection.content || ''}</div>
                </div>
            `;
        };

        let sectionsHTML = '';
        sectionOrder.forEach(sectionIdentifier => {
            if (sectionIdentifier.startsWith('table-')) {
                const tableSection = tableSectionsMap.get(sectionIdentifier);
                if (tableSection) {
                    sectionsHTML += createTableSection(tableSection);
                }
            } else if (sectionIdentifier.startsWith('text-')) {
                const textSection = textSectionsMap.get(sectionIdentifier);
                if (textSection) {
                    sectionsHTML += createTextSection(textSection);
                }
            }
        });

        tableSectionsMap.forEach((tableSection, identifier) => {
            if (!sectionOrder.includes(identifier)) {
                sectionsHTML += createTableSection(tableSection);
            }
        });

        textSectionsMap.forEach((textSection, identifier) => {
            if (!sectionOrder.includes(identifier)) {
                sectionsHTML += createTextSection(textSection);
            }
        });

        const isInComparison = comparedRates.has(rate.id);
        const buttonDisplay = isInComparison ? 'display: none;' : '';

        const compareButton = `
            <div class="rate-card-actions"
                 style="display: flex; justify-content: flex-end; gap: 16px; margin-bottom:16px; margin-right: 25px;">

                <a class="angebot-btn"
                   href="${rate.webLink || '#'}"
                   target="_blank"
                   title="Open Link">
                    ZUM ANGEBOT
                </a>

                <button type="button"
                        class="mehr-info-btn"
                        onclick="startComparisonFromCard(${rate.id})"
                        style="${buttonDisplay}">
                    VERGLEICHEN
                </button>
            </div>
        `;

    card.innerHTML = `
        <style>
          @media (max-width: 768px) {
            .mobile-hr { display: block; }
          }
          @media (min-width: 769px) {
            .mobile-hr { display: none; }
          }
        </style>

        <div class="rate-expanded-content show">
            ${sectionsHTML}
            ${compareButton}
        </div>
    `;

        return card;
    }

    function startComparisonFromCard(currentRateId) {
        if (comparedRates.size >= maxComparisons) {
            showStatus('Maximum number of comparisons reached (3)', 'warning');
            return;
        }

        // 1. Activate Comparison Mode
        document.body.classList.add('comparison-mode');

        // **CRITICAL FIX: Align checkboxes immediately**
        alignExternalCheckboxes();

        const comparisonSection = document.getElementById('comparisonSection');
        if (comparisonSection) {
            comparisonSection.style.display = 'block';
        }

        const quickCompareBtn = document.getElementById('quickCompareBtn');
        if (quickCompareBtn) {
            quickCompareBtn.style.display = 'none';
        }

        let shouldAddFirstRecord = comparedRates.size === 0;

        if (shouldAddFirstRecord) {
            let firstRateId = allLoadedData.length > 0 ? allLoadedData[0].id : null;

            if (firstRateId && firstRateId !== currentRateId && comparedRates.size < maxComparisons) {
                const firstRate = allLoadedData.find(r => r.id === firstRateId);
                if (firstRate) {
                    comparedRates.set(firstRateId, firstRate);
                    const firstCheckbox = document.getElementById(`external-compare-${firstRateId}`);
                    if (firstCheckbox) firstCheckbox.checked = true;
                    updateTableRowHighlight(firstRateId, true);
                }
            }
        }

        if (comparedRates.has(currentRateId)) {
            showStatus('This rate is already in comparison', 'info');
            scrollToComparison();
            setTimeout(() => {
                closeExpandedCard(currentRateId);
            }, 1000);
            return;
        }

        if (comparedRates.size >= maxComparisons) {
            showStatus('Maximum number of comparisons reached (3)', 'warning');
            return;
        }

        let currentRate = allLoadedData.find(r => r.id === currentRateId);
        if (!currentRate) {
            fetchRateDetails(currentRateId).then(fetchedRate => {
                if (fetchedRate) {
                    comparedRates.set(currentRateId, fetchedRate);
                    if (fetchedRate.fieldValues) {
                        serverRateFieldValuesMap[currentRateId] = fetchedRate.fieldValues;
                    }
                    updateComparisonDisplay();
                    scrollToComparison();
                }
            });
        } else {
            comparedRates.set(currentRateId, currentRate);
            const currentCheckbox = document.getElementById(`external-compare-${currentRateId}`);
            if (currentCheckbox) currentCheckbox.checked = true;
            updateTableRowHighlight(currentRateId, true);
        }

        updateComparisonDisplay();
        scrollToComparison();

        const rateCount = comparedRates.size;
        if (rateCount === 1) {
            showStatus('Comparison mode activated! Rate added to comparison.', 'success');
        } else {
            showStatus(`${rateCount} rates added to comparison!`, 'success');
        }

        setTimeout(() => {
            closeExpandedCard(currentRateId);
        }, 1000);
    }

    function scrollToComparison() {
        setTimeout(() => {
            const comparisonSection = document.getElementById('comparisonSection');
            if (comparisonSection) {
                comparisonSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }, 500);
    }

    function closeExpandedCard(rateId) {
        const tableContainer = document.getElementById('tableContainer');
        const isMobileCardView = tableContainer && tableContainer.classList.contains('mobile-stack');

        if (isMobileCardView) {
            const mobileCard = document.querySelector(`div.mobile-interest-card[data-rate-id="${rateId}"]`);
            if (mobileCard) {
                const expandedContent = mobileCard.querySelector('.rate-card');
                if (expandedContent) {
                    expandedContent.remove();
                }
                mobileCard.classList.remove('card-expanded');
            }
        } else {
            const cardRow = document.getElementById(`rateCardRow_${rateId}`);
            if (cardRow) {
                cardRow.style.display = 'none';
                cardRow.classList.remove('show');
                requestAnimationFrame(() => {
                    if (cardRow.parentNode) {
                        cardRow.parentNode.removeChild(cardRow);
                    }
                });
            }
        }

        if (currentExpandedCard === rateId) {
            currentExpandedCard = null;
        }

        expandedRateCards.delete(rateId);
        updateMehrInfoButton(rateId, false);
    }

    function updateMehrInfoButton(rateId, isExpanded) {
        const tableButton = document.querySelector(`tr[data-rate-id="${rateId}"] .mehr-info-btn`);
        const mobileButton = document.querySelector(`div[data-rate-id="${rateId}"] .mehr-info-btn`);

        const buttons = [tableButton, mobileButton].filter(btn => btn !== null);

        buttons.forEach(button => {
            if (button && !button.disabled) {
                const isMobileButton = button.closest('.mobile-interest-card') !== null;

                if (isExpanded) {
                    button.innerHTML = `<svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14.9995 9L7.99951 2L0.999512 9" stroke="#00AC98" stroke-width="2"/>
                    </svg>`;
                    button.title = "Hide info";
                } else {
                    const buttonText = isMobileButton ? 'MEHR' : 'MEHR INFO';
                    button.innerHTML = `${buttonText} <svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 1L8 8L15 1" stroke="#00AC98" stroke-width="2"/>
                    </svg>`;
                    button.title = "Show more info";
                }
            }
        });
    }

    function fetchRateDetails(rateId) {
        return fetch(`/api/interest-rate/${rateId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch rate details');
                }
                return response.json();
            })
            .catch(error => {
                console.error('Error fetching rate details:', error);
                showDeleteNotification('Error loading rate details: ' + error.message, true);
                return null;
            });
    }

    function quickStartComparison() {
        if (!allLoadedData || allLoadedData.length === 0) {
            showStatus('No rates available to compare.', 'warning');
            return;
        }

        const firstRate = allLoadedData[0];
        const firstRateId = firstRate.id;

        document.getElementById("quickCompareBtn").style.display = "none";
        document.body.classList.add('comparison-mode');

        alignExternalCheckboxes();

        const comparisonSection = document.getElementById('comparisonSection');
        if (comparisonSection) {
            comparisonSection.style.display = 'block';
        }

        if (!comparedRates.has(firstRateId)) {
            const rate = allLoadedData.find(r => r.id === firstRateId);

            if (rate) {
                comparedRates.set(firstRateId, rate);

                const firstCheckbox = document.getElementById(`external-compare-${firstRateId}`);
                if (firstCheckbox) {
                    firstCheckbox.checked = true;
                }

                updateTableRowHighlight(firstRateId, true);

                updateVergleichenButtonVisibility(firstRateId, true);
            }
        }

        updateComparisonDisplay();
        scrollToComparison();

        const rateCount = comparedRates.size;
        showStatus(`Comparison mode activated! ${rateCount} rate${rateCount === 1 ? ' is' : 's are'} selected.`, 'success');
    }

    function updateExternalCheckboxes(data) {
        const checkboxColumn = document.getElementById('externalCheckboxes');
        if (!checkboxColumn) return;

        if (!data || data.length === 0) {
            checkboxColumn.innerHTML = '';
            return;
        }

        const checkboxRows = data.map(rate => {
            const isSelected = comparedRates.has(rate.id);
            return `
                <div class="external-checkbox-row" data-rate-id="${rate.id}">
                    <div class="custom-checkbox-container">
                        <input type="checkbox"
                               class="comparison-checkbox external-checkbox"
                               onchange="toggleComparison(${rate.id}, this.checked)"
                               id="external-compare-${rate.id}"
                               ${isSelected ? 'checked' : ''}>
                        <div class="custom-checkbox"></div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function alignExternalCheckboxes() {
        const table = document.getElementById('mainTable');
        const externalCheckboxes = document.getElementById('externalCheckboxes');

        if (!table || !externalCheckboxes) return;

        if (!document.body.classList.contains('comparison-mode')) {
            externalCheckboxes.innerHTML = '';
            return;
        }

        const rows = table.querySelectorAll('tbody tr:not(.rate-card-row)');
        externalCheckboxes.innerHTML = '';

        if (rows.length === 0) return;

        rows.forEach((row) => {
            const rateId = row.getAttribute('data-rate-id');
            if (!rateId) return;

            const checkboxRow = document.createElement('div');
            checkboxRow.className = 'external-checkbox-row';
            checkboxRow.setAttribute('data-rate-id', rateId);

            const checkboxContainer = document.createElement('div');
            checkboxContainer.className = 'custom-checkbox-container';

            const checkboxInput = document.createElement('input');
            checkboxInput.type = 'checkbox';
            checkboxInput.className = 'comparison-checkbox external-checkbox';
            checkboxInput.id = `external-compare-${rateId}`;

            const isSelected = comparedRates.has(parseInt(rateId));
            checkboxInput.checked = isSelected;

            const customCheckbox = document.createElement('div');
            customCheckbox.className = 'custom-checkbox';

            checkboxInput.addEventListener('change', () => {
                toggleComparison(parseInt(rateId), checkboxInput.checked);
            });

            customCheckbox.addEventListener('click', () => {
                checkboxInput.checked = !checkboxInput.checked;
                checkboxInput.dispatchEvent(new Event('change'));
            });

            checkboxContainer.appendChild(checkboxInput);
            checkboxContainer.appendChild(customCheckbox);
            checkboxRow.appendChild(checkboxContainer);

            externalCheckboxes.appendChild(checkboxRow);
        });

        requestAnimationFrame(() => {
            positionCheckboxes();
        });
    }

    function positionCheckboxes() {
        const table = document.getElementById('mainTable');
        const externalCheckboxes = document.getElementById('externalCheckboxes');

        if (!table || !externalCheckboxes) return;

        const rows = table.querySelectorAll('tbody tr:not(.rate-card-row)');
        const checkboxRows = externalCheckboxes.querySelectorAll('.external-checkbox-row');

        rows.forEach((row, index) => {
            const checkboxRow = checkboxRows[index];
            if (!checkboxRow) return;

            const rowHeight = row.offsetHeight;
            const rowTop = row.offsetTop;

            checkboxRow.style.position = 'absolute';
            checkboxRow.style.top = `${rowTop}px`;
            checkboxRow.style.height = `${rowHeight}px`;
            checkboxRow.style.display = 'flex';
            checkboxRow.style.alignItems = 'center';
        });
    }

    window.addEventListener('load', alignExternalCheckboxes);
    window.addEventListener('resize', alignExternalCheckboxes);

    function createMobileCard(rate) {
        const headers = document.querySelectorAll('.draggable-column, .sortable');
        const currentFieldOrder = Array.from(headers)
            .map(header => ({
                id: header.dataset.fieldId,
                fieldKey: header.dataset.fieldKey,
                label: header.querySelector('.header-text').textContent.trim()
            }));

        const isSelected = comparedRates && comparedRates.has ? comparedRates.has(rate.id) : false;
        const fieldValues = serverRateFieldValuesMap[rate.id] || {};

        let logoHtml = '<span style="color: #6c757d; font-size: 12px;">logo</span>';
        const imageField = currentFieldOrder.find(f => f.fieldKey && f.fieldKey.toLowerCase().includes('img'));
        if (imageField && fieldValues[imageField.id]) {
            logoHtml = `<img src="${fieldValues[imageField.id]}" alt="Logo" style="max-height: 50px; max-width: 100px; object-fit: contain;">`;
        }

        const displayFields = currentFieldOrder
            .filter(field => !(field.fieldKey && field.fieldKey.toLowerCase().includes('img')))
            .slice(1, 5);

        const gridHtml = displayFields.map(field => {
            const value = fieldValues[field.id] || '-';
            return `
                <div class="info-field">
                    <div class="info-field-label">${field.label.toUpperCase()}</div>
                    <div class="info-field-value">${value}</div>
                </div>
            `;
        }).join('');

        const rateValue = fieldValues[currentFieldOrder[0]?.id] || '0,00';
        const isExpanded = expandedRateCards.has(rate.id);

        return `
            <div class="mobile-card-row" data-rate-id="${rate.id}">
                <div class="mobile-interest-card" data-rate-id="${rate.id}" ${isExpanded ? 'class="mobile-interest-card card-expanded"' : 'class="mobile-interest-card"'}>
                    <div class="card-header">
                        <h6 data-rate="${rateValue}"></h6>
                        <div class="card-logo-area">
                            ${logoHtml}
                        </div>
                        <div class="card-logo-area">
                            <button class="mehr-info-btn"
                                    ${rate.moreInfo ? '' : 'disabled'}
                                    onclick="showMoreInfo(${rate.id})"
                                    title="${rate.moreInfo ? 'Show more info' : 'No additional info available'}">
                                ${isExpanded ?
                                    `<svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 7L6 2L1 7" stroke="currentColor" stroke-width="2"/></svg>` :
                                    `MEHR <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2"/></svg>`
                                }
                            </button>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="card-info-grid">
                            ${gridHtml}
                        </div>
                    </div>
                    ${isExpanded ? createRateCard(rate).outerHTML : ''}
                </div>
            </div>
        `;
    }

</script>
<script>
    function updateLogoForTheme() {
        const navLogo = document.querySelector('.nav-logo');
        if (!navLogo) return;

        const svgs = navLogo.querySelectorAll('svg');
        if (svgs.length !== 2) return;

        const darkSvg = svgs[1];
        const lightSvg = svgs[0];

        const isDarkMode = document.documentElement.classList.contains('dark-mode');

        if (isDarkMode) {
            darkSvg.style.display = 'block';
            lightSvg.style.display = 'none';
        } else {
            darkSvg.style.display = 'none';
            lightSvg.style.display = 'block';
        }
    }

    document.addEventListener('DOMContentLoaded', updateLogoForTheme);

    window.addEventListener('storage', updateLogoForTheme);

    const observer = new MutationObserver(updateLogoForTheme);
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
    });

    document.addEventListener('click', function(e) {
        if (e.target.closest('#darkModeBtn') || e.target.closest('#lightModeBtn')) {
            setTimeout(updateLogoForTheme, 50);
        }
    });

    if (window.darkModeControls) {
        const originalEnable = window.darkModeControls.enable;
        const originalDisable = window.darkModeControls.disable;

        window.darkModeControls.enable = function() {
            originalEnable.call(this);
            updateLogoForTheme();
        };

        window.darkModeControls.disable = function() {
            originalDisable.call(this);
            updateLogoForTheme();
        };
    }
</script>
<script defer src="/js/dark-mode.js"></script>
</body>
</html>